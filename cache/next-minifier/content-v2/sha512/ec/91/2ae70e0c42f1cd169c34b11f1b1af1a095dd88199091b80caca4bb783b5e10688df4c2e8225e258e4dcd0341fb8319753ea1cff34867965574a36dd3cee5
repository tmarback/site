{"code":"(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[207],{\"4nv/\":function(e,t,a){\"use strict\";function n(e,t,a,n){a&&Object.defineProperty(e,t,{enumerable:a.enumerable,configurable:a.configurable,writable:a.writable,value:a.initializer?a.initializer.call(n):void 0})}a.d(t,\"a\",(function(){return n}))},ACih:function(e,t,a){\"use strict\"},EaFg:function(e,t,a){\"use strict\";function n(e,t,a,n,r){var o={};return Object.keys(n).forEach((function(e){o[e]=n[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,(\"value\"in o||o.initializer)&&(o.writable=!0),o=a.slice().reverse().reduce((function(a,n){return n(e,t,a)||a}),o),r&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}a.d(t,\"a\",(function(){return n}))},QcNg:function(e,t,a){\"use strict\";a.d(t,\"a\",(function(){return r}));var n=a(\"E/M9\");const r=e=>{var t,a,r;const o={};o.content=null!==(t=e.content)&&void 0!==t?t:\"\",o.username=null!==(a=e.username)&&void 0!==a?a:\"\",o.avatar=null!==(r=e.avatar_url)&&void 0!==r?r:\"\";const s=[];o.embeds=s;for(const P of null!==(i=e.embeds)&&void 0!==i?i:[]){var i,c,l,u,d,b,p,j,h,g,m,f,v,O,w,k,y,x,C,M,B;let e=s.length>0?s[s.length-1]:void 0;if(null!==(c=e)&&void 0!==c&&c.url&&e.url===P.url){var D;const t=e.gallery;null!==(D=P.image)&&void 0!==D&&D.url&&t.length<4&&t.push(P.image.url);continue}e={},s.push(e),e.title=null!==(l=P.title)&&void 0!==l?l:\"\",e.description=null!==(u=P.description)&&void 0!==u?u:\"\",e.url=null!==(d=P.url)&&void 0!==d?d:\"\",e.author=null!==(b=null===(p=P.author)||void 0===p?void 0:p.name)&&void 0!==b?b:\"\",e.authorUrl=null!==(j=null===(h=P.author)||void 0===h?void 0:h.url)&&void 0!==j?j:\"\",e.authorIcon=null!==(g=null===(m=P.author)||void 0===m?void 0:m.icon_url)&&void 0!==g?g:\"\",e.footer=null!==(f=null===(v=P.footer)||void 0===v?void 0:v.text)&&void 0!==f?f:\"\",e.footerIcon=null!==(O=null===(w=P.footer)||void 0===w?void 0:w.icon_url)&&void 0!==O?O:\"\",e.timestamp=new Date(null!==(k=P.timestamp)&&void 0!==k?k:Number.NaN),e.gallery=[null!==(y=null===(x=P.image)||void 0===x?void 0:x.url)&&void 0!==y?y:\"\"].filter(Boolean),e.thumbnail=null!==(C=null===(M=P.thumbnail)||void 0===M?void 0:M.url)&&void 0!==C?C:\"\";const t=n.a.create();t.setRaw(null!==(B=P.color)&&void 0!==B?B:null),e.color=t;const a=[];e.fields=a;for(const n of null!==(S=P.fields)&&void 0!==S?S:[]){var S,L,I,E;const e={};a.push(e),e.name=null!==(L=n.name)&&void 0!==L?L:\"\",e.value=null!==(I=n.value)&&void 0!==I?I:\"\",e.inline=null!==(E=n.inline)&&void 0!==E&&E}}return o}},uid3:function(e,t,a){\"use strict\";a.r(t),a.d(t,\"BackupsModal\",(function(){return Ie}));var n=a(\"nKUr\"),r=a(\"aoTL\"),o=a(\"q1tI\"),s=a(\"GyG+\"),i=a(\"JrLk\"),c=a(\"KpTw\"),l=a(\"LZrb\"),u=a(\"YmNt\"),d=a(\"g+2O\"),b=a(\"nGg0\"),p=a(\"mNbY\"),j=a(\"xnAi\"),h=a(\"uEgJ\"),g=a(\"ytgV\"),m=a(\"eoCo\"),f=a(\"4nv/\"),v=a(\"EaFg\"),O=(a(\"ACih\"),a(\"2vnA\"));let w,k;const y=new WeakMap,x=new WeakMap,C=new WeakMap,M=new WeakMap,B=new WeakMap;let D={get(e,t,a){if(e instanceof IDBTransaction){if(\"done\"===t)return x.get(e);if(\"objectStoreNames\"===t)return e.objectStoreNames||C.get(e);if(\"store\"===t)return a.objectStoreNames[1]?void 0:a.objectStore(a.objectStoreNames[0])}return I(e[t])},set:(e,t,a)=>(e[t]=a,!0),has:(e,t)=>e instanceof IDBTransaction&&(\"done\"===t||\"store\"===t)||t in e};function S(e){return e!==IDBDatabase.prototype.transaction||\"objectStoreNames\"in IDBTransaction.prototype?(k||(k=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(E(this),t),I(y.get(this))}:function(...t){return I(e.apply(E(this),t))}:function(t,...a){const n=e.call(E(this),t,...a);return C.set(n,t.sort?t.sort():[t]),I(n)}}function L(e){return\"function\"===typeof e?S(e):(e instanceof IDBTransaction&&function(e){if(x.has(e))return;const t=new Promise(((t,a)=>{const n=()=>{e.removeEventListener(\"complete\",r),e.removeEventListener(\"error\",o),e.removeEventListener(\"abort\",o)},r=()=>{t(),n()},o=()=>{a(e.error||new DOMException(\"AbortError\",\"AbortError\")),n()};e.addEventListener(\"complete\",r),e.addEventListener(\"error\",o),e.addEventListener(\"abort\",o)}));x.set(e,t)}(e),t=e,(w||(w=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e))?new Proxy(e,D):e);var t}function I(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,a)=>{const n=()=>{e.removeEventListener(\"success\",r),e.removeEventListener(\"error\",o)},r=()=>{t(I(e.result)),n()},o=()=>{a(e.error),n()};e.addEventListener(\"success\",r),e.addEventListener(\"error\",o)}));return t.then((t=>{t instanceof IDBCursor&&y.set(t,e)})).catch((()=>{})),B.set(t,e),t}(e);if(M.has(e))return M.get(e);const t=L(e);return t!==e&&(M.set(e,t),B.set(t,e)),t}const E=e=>B.get(e);const P=[\"get\",\"getKey\",\"getAll\",\"getAllKeys\",\"count\"],N=[\"put\",\"add\",\"delete\",\"clear\"],A=new Map;function V(e,t){if(!(e instanceof IDBDatabase)||t in e||\"string\"!==typeof t)return;if(A.get(t))return A.get(t);const a=t.replace(/FromIndex$/,\"\"),n=t!==a,r=N.includes(a);if(!(a in(n?IDBIndex:IDBObjectStore).prototype)||!r&&!P.includes(a))return;const o=async function(e,...t){const o=this.transaction(e,r?\"readwrite\":\"readonly\");let s=o.store;return n&&(s=s.index(t.shift())),(await Promise.all([s[a](...t),r&&o.done]))[0]};return A.set(t,o),o}D=(e=>({...e,get:(t,a,n)=>V(t,a)||e.get(t,a,n),has:(t,a)=>!!V(t,a)||e.has(t,a)}))(D);const z=()=>{const e=document.createElement(\"div\");e.id=\"db-upgrade-blocked\",e.style.position=\"absolute\",e.style.top=\"0\",e.style.right=\"0\",e.style.bottom=\"0\",e.style.left=\"0\",e.style.background=\"rgba(0, 0, 0, 0.85)\",e.style.padding=\"16px\";const t=document.createElement(\"h1\");t.style.color=\"#ffffff\",t.append(\"Discohook's local database needs an upgrade\");const a=document.createElement(\"p\");a.append(\"However, the upgrade can't proceed because there are older sessions of Discohook open.\");const n=document.createElement(\"p\");n.append(\"Please close all Discohook tabs before continuing.\"),e.append(t,a,n),document.body.append(e)};var W=a(\"dhJC\"),q=a(\"cpVT\");const H=e=>\"object\"===typeof e&&null!==e,K=(e,t)=>{if(Array.isArray(e))return e.map((e=>H(e)?K(e,t):e));const a={};for(const[n,r]of Object.entries(e))H(r)?a[t(n)]=K(r,t):a[t(n)]=r;return a},U=e=>K(e,(e=>e.replace(/[A-Z]/g,(e=>`_${e.toLowerCase()}`))));function R(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function T(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?R(Object(a),!0).forEach((function(t){Object(q.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):R(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const J=async()=>function(e,t,{blocked:a,upgrade:n,blocking:r,terminated:o}={}){const s=indexedDB.open(e,t),i=I(s);return n&&s.addEventListener(\"upgradeneeded\",(e=>{n(I(s.result),e.oldVersion,e.newVersion,I(s.transaction))})),a&&s.addEventListener(\"blocked\",(()=>a())),i.then((e=>{o&&e.addEventListener(\"close\",(()=>o())),r&&e.addEventListener(\"versionchange\",(()=>r()))})).catch((()=>{})),i}(\"discohook\",10,{upgrade:(e,t,a,n)=>{(async(e,t,a)=>{if(a<2&&a>=1){let e=await t.objectStore(\"backups\").openCursor();for(;e;)await e.update({name:e.key,message:e.value}),e=await e.continue()}a<3&&(e.createObjectStore(\"backup\",{keyPath:\"id\",autoIncrement:!0}),t.objectStore(\"backup\").createIndex(\"name\",\"name\",{unique:!0}));if(a<4&&a>=1){const e=t.objectStore(\"backup\"),a=new Set;let n=await e.index(\"name\").openKeyCursor();for(;n;)a.add(n.key),n=await n.continue();let r=await t.objectStore(\"backups\").openCursor();for(;r;)a.has(r.key)||await e.put(T(T({},r.value),{},{name:r.key,message:U(r.value.message)})),r=await r.continue()}if(a<5&&a>=1){const e=t.objectStore(\"backup\");let a=await e.openCursor();for(;a;){const t=a.value,{message:n}=t,r=Object(W.a)(t,[\"message\"]);await e.put(T(T({},r),{},{messages:[n]})),a=await a.continue()}}if(a<6&&a>=1){const e=t.objectStore(\"backup\");let a=await e.openCursor();for(;a;){const t=a.value,{webhookUrl:n}=t,r=Object(W.a)(t,[\"webhookUrl\"]);await e.put(T(T({},r),{},{target:{url:n}})),a=await a.continue()}}if(a<9&&a>=1){const e=t.objectStore(\"backup\");let a=await e.openCursor();for(;a;){const{id:t,name:n,messages:r,target:o}=a.value;n?await e.put({id:t,name:n,messages:r.map((e=>({data:\"data\"in e?e.data:e,reference:\"reference\"in e?e.reference:o.message}))),target:{url:o.url}}):await e.delete(t),a=await a.continue()}}if(a<10&&a>=1){const e=t.objectStore(\"backup\");let a=await e.openCursor();for(;a;){var n;const t=a.value,{target:r}=t,o=Object(W.a)(t,[\"target\"]);await e.put(T(T({},o),{},{targets:[{url:null!==(n=r.url)&&void 0!==n?n:\"\"}]})),a=await a.continue()}}})(e,n,t).then((()=>{var e;localStorage.setItem(\"database-upgraded-version\",\"10\"),null===(e=document.querySelector(\"#db-upgrade-blocked\"))||void 0===e||e.remove()})).catch((e=>{console.error(\"Error on database upgrade:\",e)}))},blocked:z});var _,F,$;let Z=(_=class{constructor(){let e;this.initialized=void 0,this.database=void 0,Object(f.a)(this,\"persisted\",F,this),Object(f.a)(this,\"persistenceMessageDismissed\",$,this),this.initialized=new Promise((t=>{e=t})),\"storage\"in navigator&&navigator.storage.persisted().then((e=>{this.persisted=e})).catch((()=>{})),J().then((t=>{this.database=t,e()})).catch((e=>{console.error(\"Failed to open database:\",e)}))}async requestPersistence(){\"chrome\"in window&&await Notification.requestPermission(),\"storage\"in navigator&&(this.persisted=await navigator.storage.persist())}get shouldShowPersistenceWarning(){return!this.persisted&&!this.persistenceMessageDismissed}},F=Object(v.a)(_.prototype,\"persisted\",[O.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),$=Object(v.a)(_.prototype,\"persistenceMessageDismissed\",[O.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(v.a)(_.prototype,\"shouldShowPersistenceWarning\",[O.computed],Object.getOwnPropertyDescriptor(_.prototype,\"shouldShowPersistenceWarning\"),_.prototype),_);const Y=Object(o.createContext)(null);Y.displayName=\"DatabaseManagerContext\";const G=Y.Provider;var Q=a(\"vOnD\"),X=a(\"aNhp\"),ee=a(\"+VeW\"),te=a(\"Kn7Z\");function ae(e){const{databaseManager:t}=e,a=Object(g.a)(j.a);return Object(n.jsxs)(u.a,{children:[Object(n.jsxs)(b.a,{children:[Object(n.jsx)(p.a,{children:\"Notice\"}),Object(n.jsx)(c.a,{icon:m.a,label:\"Close\",onClick:()=>a.dismiss()})]}),Object(n.jsx)(l.a,{children:Object(n.jsx)(te.a,{content:\"Chrome based browsers do not allow manual control of persistent storage. As a workaround, you can grant this site permission to send notifications to allow the site to use persistent storage.\"})}),Object(n.jsxs)(d.a,{children:[Object(n.jsx)(i.a,{onClick:()=>a.dismiss(),children:\"Cancel\"}),Object(n.jsx)(s.a,{onClick:async()=>{a.dismiss(),await t.requestPersistence()},children:\"Request permission\"})]})]})}const ne=Q.d.div.withConfig({componentId:\"sc-3x6mdx-0\"})([\"margin-top:16px;padding:16px;background:\",\";border-radius:3px;\"],(({theme:e})=>e.background.secondary)),re=Q.d.h5.withConfig({componentId:\"sc-3x6mdx-1\"})([\"margin:0 0 8px;color:\",\";font-size:1em;font-weight:500;line-height:1.375;\"],(({theme:e})=>e.header.primary)),oe=Object(Q.d)(X.a).withConfig({componentId:\"sc-3x6mdx-2\"})([\"margin-top:16px;\"]);function se(){const e=Object(g.a)(ee.a),t=Object(g.a)(Y);return Object(r.b)((()=>Object(n.jsxs)(ne,{children:[Object(n.jsx)(re,{children:\"Warning\"}),Object(n.jsx)(te.a,{content:\"Your browser did not grant permission to use persistent storage for this site. Data stored might be deleted by the browser when this permission is not granted.\"}),Object(n.jsxs)(oe,{children:[Object(n.jsx)(s.a,{onClick:async()=>{\"chrome\"in window?e.spawn({render:()=>Object(n.jsx)(ae,{databaseManager:t})}):await t.requestPersistence()},children:\"Request permission\"}),Object(n.jsx)(i.a,{onClick:()=>{t.persistenceMessageDismissed=!0},children:\"Dismiss\"})]})]})))}const ie=(e,t)=>{const a=URL.createObjectURL(e),n=document.createElement(\"a\");document.body.append(n),n.href=a,n.download=t,n.click(),n.remove(),URL.revokeObjectURL(a)};var ce,le,ue=a(\"QcNg\");function de(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function be(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?de(Object(a),!0).forEach((function(t){Object(q.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):de(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}let pe=(ce=class{constructor(e,t){this.databaseManager=void 0,this.editorManager=void 0,Object(f.a)(this,\"backups\",le,this),this.databaseManager=e,this.editorManager=t,e.initialized.then((async()=>{await this.loadBackupList()})).catch((()=>{}))}async loadBackupList(){const e=[];let t=await this.databaseManager.database.transaction(\"backup\").objectStore(\"backup\").index(\"name\").openKeyCursor();for(;t;)e.push({id:t.primaryKey,name:t.key}),t=await t.continue();Object(O.runInAction)((()=>{this.backups=e}))}async getId(e){return this.databaseManager.database.transaction(\"backup\").objectStore(\"backup\").index(\"name\").getKey(e)}async loadBackup(e){const t=await this.databaseManager.database.transaction(\"backup\").objectStore(\"backup\").index(\"name\").get(e);if(t){this.editorManager.set(\"messages\",t.messages.map((e=>{let{data:t}=e,a=Object(W.a)(e,[\"data\"]);return be(be({},Object(ue.a)(t)),a)}))),this.editorManager.set(\"targets\",t.targets);for(const e of this.editorManager.targets)e.fetch().catch((()=>{}))}}async saveBackup(e){if(\"string\"===typeof e){e={id:await this.getId(e),name:e,messages:this.editorManager.messages.map((e=>({data:be(be({},e.data),{},{files:void 0}),reference:e.reference}))),targets:this.editorManager.targets.map((e=>({url:e.url})))}}else e=be(be({},e),{},{id:await this.getId(e.name)});e.id||delete e.id,await this.databaseManager.database.transaction(\"backup\",\"readwrite\").objectStore(\"backup\").put(e),await this.loadBackupList()}async deleteBackup(e){const t=await this.getId(e);t&&(await this.databaseManager.database.transaction(\"backup\",\"readwrite\").objectStore(\"backup\").delete(t),await this.loadBackupList())}async exportBackup(e){const t=await this.databaseManager.database.transaction(\"backup\").objectStore(\"backup\").index(\"name\").get(e);if(!t)return;const a={version:7,backups:[t].map((e=>{let{id:t}=e;return Object(W.a)(e,[\"id\"])}))},n=new Blob([JSON.stringify(a,void 0,2),\"\\n\"],{type:\"application/json\"});ie(n,`${e}.json`)}async exportAll(){const e=[];let t=await this.databaseManager.database.transaction(\"backup\").objectStore(\"backup\").openCursor();for(;t;)e.push(be(be({},t.value),{},{id:void 0})),t=await t.continue();const a={version:7,backups:e},n=new Blob([JSON.stringify(a,void 0,2),\"\\n\"],{type:\"application/json\"});ie(n,\"backups.json\")}async getSafeBackupName(e){if(!(await this.getId(e)))return e;for(let t=1;;t++){const a=`${e} (${t})`;if(!(await this.getId(a)))return a}}async importBackups(e){let t=JSON.parse(await e.text());switch(t.version){case 1:case 2:t={version:3,backups:[{name:t.name,message:U(t.message)}]};case 3:t={version:4,backups:t.backups.map((e=>{let{message:t}=e;return be(be({},Object(W.a)(e,[\"message\"])),{},{messages:[t]})}))};case 4:t={version:5,backups:t.backups.map((e=>{let{webhookUrl:t}=e;return be(be({},Object(W.a)(e,[\"webhookUrl\"])),{},{target:{url:t}})}))};case 5:t={version:6,backups:t.backups.map((e=>{let{messages:t,target:a}=e;return be(be({},Object(W.a)(e,[\"messages\",\"target\"])),{},{messages:t.map((e=>({data:e,reference:a.message}))),target:{url:a.url}})}))};case 6:t={version:7,backups:t.backups.map((e=>{var t;let{target:a}=e;return be(be({},Object(W.a)(e,[\"target\"])),{},{targets:[{url:null!==(t=a.url)&&void 0!==t?t:\"\"}]})}))};case 7:for(const e of t.backups)await this.saveBackup(be(be({},e),{},{name:await this.getSafeBackupName(e.name),id:void 0}))}}},le=Object(v.a)(ce.prototype,\"backups\",[O.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ce);const je=Object(o.createContext)(null);je.displayName=\"BackupManagerContext\";const he=je.Provider;var ge=a(\"8bSZ\");function me(){const e=Object(g.a)(je),{0:t,1:a}=Object(o.useState)(\"\");return Object(r.b)((()=>Object(n.jsx)(ge.a,{id:\"backup-name\",value:t,onChange:a,label:\"Backup name\",children:Object(n.jsx)(s.a,{disabled:0===t.length,onClick:async()=>{await e.saveBackup(t.trim()),a(\"\")},children:e.backups.some((e=>e.name===t.trim()))?\"Overwrite\":\"Save\"})})))}var fe=a(\"ufqH\"),ve=a(\"AFXh\"),Oe=a(\"MKkt\"),we=a(\"C8f0\");const ke=Object(n.jsx)(\"svg\",{width:\"16\",height:\"16\",viewBox:\"0 0 16 16\",fill:\"none\",children:Object(n.jsx)(\"path\",{d:\"M11 15V9H5V15M5 1L4.99999 5H10M13.6667 15H2.33333C1.97971 15 1.64057 14.8595 1.39052 14.6095C1.14048 14.3594 1 14.0203 1 13.6667V2.33333C1 1.97971 1.14048 1.64057 1.39052 1.39052C1.64057 1.14048 1.97971 1 2.33333 1H11.6667L15 4.33333V13.6667C15 14.0203 14.8595 14.3594 14.6095 14.6095C14.3594 14.8595 14.0203 15 13.6667 15Z\",stroke:\"currentColor\",strokeWidth:\"2\",strokeLinecap:\"round\",strokeLinejoin:\"round\"})}),ye=Object(n.jsx)(\"svg\",{width:\"16\",height:\"16\",viewBox:\"0 0 16 16\",fill:\"none\",children:Object(n.jsx)(\"path\",{d:\"M1 4L2.99999 3.99998M2.99999 3.99998V13.5C2.99999 14.3284 3.67156 15 4.49999 15L11.5 15C12.3284 15 13 14.3284 13 13.5V4M2.99999 3.99998H5.33333M13 4H15M13 4L10.6667 3.99998M5.33333 3.99998V2.5C5.33333 1.67157 6.00491 1 6.83333 1H9.16667C9.99509 1 10.6667 1.67157 10.6667 2.5V3.99998M5.33333 3.99998H10.6667\",stroke:\"currentColor\",strokeWidth:\"2\",strokeLinecap:\"round\",strokeLinejoin:\"round\"})}),xe=Object(n.jsx)(\"svg\",{width:\"16\",height:\"16\",viewBox:\"0 0 16 16\",fill:\"none\",children:Object(n.jsx)(\"path\",{d:\"M14 10V12.6667C14 13.0203 13.8595 13.3594 13.6095 13.6095C13.3594 13.8595 13.0203 14 12.6667 14H3.33333C2.97971 14 2.64057 13.8595 2.39052 13.6095C2.14048 13.3594 2 13.0203 2 12.6667V10M4.66667 5.33333L8 2M8 2L11.3333 5.33333M8 2V10\",stroke:\"currentColor\",strokeWidth:\"2\",strokeLinecap:\"round\",strokeLinejoin:\"round\"})});function Ce(e){const{backupManager:t,backup:a}=e,o=Object(g.a)(j.a);return Object(r.b)((()=>Object(n.jsxs)(u.a,{children:[Object(n.jsxs)(b.a,{children:[Object(n.jsx)(p.a,{children:\"Delete Backup\"}),Object(n.jsx)(c.a,{icon:m.a,label:\"Close\",onClick:()=>o.dismiss()})]}),Object(n.jsx)(l.a,{children:Object(n.jsx)(te.a,{content:`Are you sure you want to delete \"${a.name}\"? This action cannot be undone.`})}),Object(n.jsxs)(d.a,{children:[Object(n.jsx)(i.a,{onClick:()=>o.dismiss(),children:\"Cancel\"}),Object(n.jsx)(s.a,{onClick:async()=>{await t.deleteBackup(a.name),o.dismiss()},children:\"Delete\"})]})]})))}const Me=Q.d.li.withConfig({componentId:\"sc-4y1qwg-0\"})([\"height:48px;display:flex;align-items:center;list-style:none;border:0 solid \",\";& + &{border-top-width:1px;}& > \",\"{margin:0;}\"],(({theme:e})=>e.backgroundModifier.accent),ve.a),Be=Q.d.div.withConfig({componentId:\"sc-4y1qwg-1\"})([\"\",\";flex:1;font-weight:500;\"],Object(fe.b)());function De(e){const{backup:t}=e,a=Object(g.a)(ee.a),o=Object(g.a)(je);return Object(r.b)((()=>Object(n.jsxs)(Me,{children:[Object(n.jsx)(Be,{children:t.name}),Object(n.jsx)(Oe.a,{actions:[{icon:xe,label:\"Load\",handler:async()=>o.loadBackup(t.name)},{icon:ke,label:\"Export\",handler:async()=>o.exportBackup(t.name),overflow:!0},{icon:we.a,label:\"Overwrite\",handler:async()=>o.saveBackup(t.name),overflow:!0},{icon:ye,label:\"Delete\",handler:()=>a.spawn({render:()=>Object(n.jsx)(Ce,{backupManager:o,backup:t})}),overflow:!0}]})]})))}const Se=Q.d.ul.withConfig({componentId:\"sc-1bbv68x-0\"})([\"padding:0;margin:0;max-height:420px;overflow-x:hidden;\"]);function Le(){const e=Object(g.a)(je),{0:t,1:a}=Object(o.useState)(\"\");return Object(r.b)((()=>e.backups.length>0?Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(ge.a,{id:\"backups-search\",label:\"Search Backups\",value:t,onChange:a}),Object(n.jsx)(Se,{children:e.backups.filter((e=>e.name.toLocaleLowerCase().includes(t.toLocaleLowerCase()))).map((e=>Object(n.jsx)(De,{backup:e},e.id)))})]}):Object(n.jsx)(te.a,{content:\"You haven't made any backups yet. Enter a name below and click on the Save button to make one.\"})))}function Ie(e){const{editorManager:t}=e,a=Object(h.a)((()=>new Z)),f=Object(h.a)((()=>new pe(a,t))),v=Object(g.a)(j.a),O=Object(o.useRef)(null);return Object(r.b)((()=>Object(n.jsx)(G,{value:a,children:Object(n.jsx)(he,{value:f,children:Object(n.jsxs)(u.a,{children:[Object(n.jsx)(\"input\",{ref:O,type:\"file\",style:{display:\"none\"},onChange:async e=>{var t,a;const n=null===(t=e.target.files)||void 0===t||null===(a=t.item(0))||void 0===a?void 0:a.slice();e.target.files=null,n&&await f.importBackups(n)}}),Object(n.jsxs)(b.a,{children:[Object(n.jsx)(p.a,{children:\"Backups\"}),Object(n.jsx)(c.a,{icon:m.a,label:\"Close\",onClick:()=>v.dismiss()})]}),a.shouldShowPersistenceWarning&&Object(n.jsx)(l.a,{children:Object(n.jsx)(se,{})}),Object(n.jsx)(l.a,{children:Object(n.jsx)(Le,{})}),Object(n.jsx)(l.a,{children:Object(n.jsx)(me,{})}),Object(n.jsxs)(d.a,{children:[Object(n.jsx)(i.a,{onClick:async()=>f.exportAll(),children:\"Export All\"}),Object(n.jsx)(i.a,{onClick:()=>{var e;return null===(e=O.current)||void 0===e?void 0:e.click()},children:\"Import\"}),Object(n.jsx)(s.a,{onClick:()=>v.dismiss(),children:\"Close\"})]})]})})})))}}}]);","map":{"version":3,"sources":["static/chunks/207.e4c247fa6390ee3db010.js"],"names":["window","push","4nv/","module","__webpack_exports__","__webpack_require__","_initializerDefineProperty","target","property","descriptor","context","Object","defineProperty","enumerable","configurable","writable","value","initializer","call","d","ACih","EaFg","_applyDecoratedDescriptor","decorators","desc","keys","forEach","key","slice","reverse","reduce","decorator","undefined","QcNg","messageOf","_common_input_color_ColorModel__WEBPACK_IMPORTED_MODULE_0__","data","_data$content","_data$username","_data$avatar_url","snapshot","content","username","avatar","avatar_url","embeds","embedData","_data$embeds","_embed","_embedData$title","_embedData$descriptio","_embedData$url","_embedData$author$nam","_embedData$author","_embedData$author$url","_embedData$author2","_embedData$author$ico","_embedData$author3","_embedData$footer$tex","_embedData$footer","_embedData$footer$ico","_embedData$footer2","_embedData$timestamp","_embedData$image$url","_embedData$image2","_embedData$thumbnail$","_embedData$thumbnail","_embedData$color","embed","length","url","_embedData$image","gallery","image","title","description","author","name","authorUrl","authorIcon","icon_url","footer","text","footerIcon","timestamp","Date","Number","NaN","filter","Boolean","thumbnail","color","create","setRaw","fields","fieldData","_embedData$fields","_fieldData$name","_fieldData$value","_fieldData$inline","field","inline","uid3","r","BackupsModal","jsx_runtime","es","react","PrimaryButton","SecondaryButton","ModalAction","ModalBody","ModalContainer","ModalFooter","ModalHeader","ModalTitle","ModalContext","useLazyValue","useRequiredContext","remove","initializerDefineProperty","applyDecoratedDescriptor","mobx_module","idbProxyableTypes","cursorAdvanceMethods","cursorRequestMap","WeakMap","transactionDoneMap","transactionStoreNamesMap","transformCache","reverseTransformCache","idbProxyTraps","[object Object]","prop","receiver","IDBTransaction","get","objectStoreNames","objectStore","wrap","set","has","wrapFunction","func","IDBDatabase","prototype","transaction","IDBCursor","advance","continue","continuePrimaryKey","includes","args","apply","unwrap","this","storeNames","tx","sort","transformCachableValue","done","Promise","resolve","reject","unlisten","removeEventListener","complete","error","DOMException","addEventListener","cacheDonePromiseForTransaction","object","IDBObjectStore","IDBIndex","some","c","Proxy","IDBRequest","request","promise","success","result","then","catch","promisifyRequest","newValue","readMethods","writeMethods","cachedMethods","Map","getMethod","targetFuncName","replace","useIndex","isWrite","method","async","storeName","store","index","shift","all","oldTraps","callback","showUpgradeBlockedMessage","container","document","createElement","id","style","position","top","right","bottom","left","background","padding","header","append","blockedMessage","closeTabsMessage","body","objectWithoutProperties","isObject","mapKeys","fn","Array","isArray","map","entries","toSnakeCase","match","toLowerCase","ownKeys","enumerableOnly","getOwnPropertySymbols","symbols","sym","getOwnPropertyDescriptor","_objectSpread","i","arguments","source","getOwnPropertyDescriptors","defineProperties","openDatabase","version","blocked","upgrade","blocking","terminated","indexedDB","open","openPromise","event","oldVersion","newVersion","db","openDB","database","cursor","openCursor","update","message","createObjectStore","keyPath","autoIncrement","createIndex","unique","backupStore","existingBackups","Set","nameCursor","openKeyCursor","add","put","_cursor$value","rest","messages","_cursor$value2","webhookUrl","reference","delete","_target$url","_cursor$value3","backup","targets","upgradeDatabase","_document$querySelect","localStorage","setItem","querySelector","console","_class","_descriptor","_descriptor2","DatabaseManager_DatabaseManager","markAsInitialized","initialized","navigator","storage","persisted","Notification","requestPermission","persist","shouldShowPersistenceWarning","persistenceMessageDismissed","DatabaseManagerContext","displayName","DatabaseManagerProvider","Provider","styled_components_browser_esm","ButtonRow","ModalManagerContext","Markdown","PushNotificationModal","props","databaseManager","modal","children","icon","label","onClick","dismiss","requestPersistence","Container","div","withConfig","componentId","theme","secondary","Header","h5","primary","Buttons","PersistentStorageWarning","modalManager","spawn","render","downloadBlob","blob","URL","createObjectURL","anchor","href","download","click","revokeObjectURL","BackupManager_class","BackupManager_descriptor","BackupManager_ownKeys","BackupManager_objectSpread","BackupManager_BackupManager","editorManager","loadBackupList","backups","primaryKey","getKey","_ref","fetch","getId","files","backupData","_ref2","Blob","JSON","stringify","type","number","proposedName","exportData","parse","_ref3","_ref4","_ref5","_ref6","saveBackup","getSafeBackupName","BackupManagerContext","BackupManagerProvider","InputField","BackupCreationControls","backupManager","0","backupName","1","setBackupName","onChange","disabled","trim","polished_esm","Button","ActionButtons","copy","save","width","height","viewBox","fill","stroke","strokeWidth","strokeLinecap","strokeLinejoin","trash","upload","DeletionConfirmationModal","deleteBackup","BackupItem_Container","li","backgroundModifier","accent","BackupName","BackupItem","actions","handler","loadBackup","exportBackup","overflow","BackupList_Container","ul","BackupList","search","setSearch","toLocaleLowerCase","fileInputRef","ref","display","_event$target$files","_event$target$files$i","file","item","importBackups","exportAll","_fileInputRef$current","current"],"mappings":"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"},"name":"static/chunks/207.e4c247fa6390ee3db010.js","input":"(window[\"webpackJsonp_N_E\"] = window[\"webpackJsonp_N_E\"] || []).push([[207],{\n\n/***/ \"4nv/\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return _initializerDefineProperty; });\nfunction _initializerDefineProperty(target, property, descriptor, context) {\n  if (!descriptor) return;\n  Object.defineProperty(target, property, {\n    enumerable: descriptor.enumerable,\n    configurable: descriptor.configurable,\n    writable: descriptor.writable,\n    value: descriptor.initializer ? descriptor.initializer.call(context) : void 0\n  });\n}\n\n/***/ }),\n\n/***/ \"ACih\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* unused harmony export default */\nfunction _initializerWarningHelper(descriptor, context) {\n  throw new Error('Decorating class property failed. Please ensure that ' + 'proposal-class-properties is enabled and runs after the decorators transform.');\n}\n\n/***/ }),\n\n/***/ \"EaFg\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return _applyDecoratedDescriptor; });\nfunction _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {\n  var desc = {};\n  Object.keys(descriptor).forEach(function (key) {\n    desc[key] = descriptor[key];\n  });\n  desc.enumerable = !!desc.enumerable;\n  desc.configurable = !!desc.configurable;\n\n  if ('value' in desc || desc.initializer) {\n    desc.writable = true;\n  }\n\n  desc = decorators.slice().reverse().reduce(function (desc, decorator) {\n    return decorator(target, property, desc) || desc;\n  }, desc);\n\n  if (context && desc.initializer !== void 0) {\n    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n    desc.initializer = undefined;\n  }\n\n  if (desc.initializer === void 0) {\n    Object.defineProperty(target, property, desc);\n    desc = null;\n  }\n\n  return desc;\n}\n\n/***/ }),\n\n/***/ \"QcNg\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return messageOf; });\n/* harmony import */ var _common_input_color_ColorModel__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(\"E/M9\");\n\nconst messageOf = data => {\n  var _data$content, _data$username, _data$avatar_url;\n\n  const snapshot = {};\n  snapshot.content = (_data$content = data.content) !== null && _data$content !== void 0 ? _data$content : \"\";\n  snapshot.username = (_data$username = data.username) !== null && _data$username !== void 0 ? _data$username : \"\";\n  snapshot.avatar = (_data$avatar_url = data.avatar_url) !== null && _data$avatar_url !== void 0 ? _data$avatar_url : \"\";\n  const embeds = [];\n  snapshot.embeds = embeds;\n\n  for (const embedData of (_data$embeds = data.embeds) !== null && _data$embeds !== void 0 ? _data$embeds : []) {\n    var _data$embeds, _embed, _embedData$title, _embedData$descriptio, _embedData$url, _embedData$author$nam, _embedData$author, _embedData$author$url, _embedData$author2, _embedData$author$ico, _embedData$author3, _embedData$footer$tex, _embedData$footer, _embedData$footer$ico, _embedData$footer2, _embedData$timestamp, _embedData$image$url, _embedData$image2, _embedData$thumbnail$, _embedData$thumbnail, _embedData$color;\n\n    let embed = embeds.length > 0 ? embeds[embeds.length - 1] : undefined;\n\n    if ((_embed = embed) !== null && _embed !== void 0 && _embed.url && embed.url === embedData.url) {\n      var _embedData$image;\n\n      const gallery = embed.gallery;\n\n      if ((_embedData$image = embedData.image) !== null && _embedData$image !== void 0 && _embedData$image.url && gallery.length < 4) {\n        gallery.push(embedData.image.url);\n      }\n\n      continue;\n    }\n\n    embed = {};\n    embeds.push(embed);\n    embed.title = (_embedData$title = embedData.title) !== null && _embedData$title !== void 0 ? _embedData$title : \"\";\n    embed.description = (_embedData$descriptio = embedData.description) !== null && _embedData$descriptio !== void 0 ? _embedData$descriptio : \"\";\n    embed.url = (_embedData$url = embedData.url) !== null && _embedData$url !== void 0 ? _embedData$url : \"\";\n    embed.author = (_embedData$author$nam = (_embedData$author = embedData.author) === null || _embedData$author === void 0 ? void 0 : _embedData$author.name) !== null && _embedData$author$nam !== void 0 ? _embedData$author$nam : \"\";\n    embed.authorUrl = (_embedData$author$url = (_embedData$author2 = embedData.author) === null || _embedData$author2 === void 0 ? void 0 : _embedData$author2.url) !== null && _embedData$author$url !== void 0 ? _embedData$author$url : \"\";\n    embed.authorIcon = (_embedData$author$ico = (_embedData$author3 = embedData.author) === null || _embedData$author3 === void 0 ? void 0 : _embedData$author3.icon_url) !== null && _embedData$author$ico !== void 0 ? _embedData$author$ico : \"\";\n    embed.footer = (_embedData$footer$tex = (_embedData$footer = embedData.footer) === null || _embedData$footer === void 0 ? void 0 : _embedData$footer.text) !== null && _embedData$footer$tex !== void 0 ? _embedData$footer$tex : \"\";\n    embed.footerIcon = (_embedData$footer$ico = (_embedData$footer2 = embedData.footer) === null || _embedData$footer2 === void 0 ? void 0 : _embedData$footer2.icon_url) !== null && _embedData$footer$ico !== void 0 ? _embedData$footer$ico : \"\";\n    embed.timestamp = new Date((_embedData$timestamp = embedData.timestamp) !== null && _embedData$timestamp !== void 0 ? _embedData$timestamp : Number.NaN);\n    embed.gallery = [(_embedData$image$url = (_embedData$image2 = embedData.image) === null || _embedData$image2 === void 0 ? void 0 : _embedData$image2.url) !== null && _embedData$image$url !== void 0 ? _embedData$image$url : \"\"].filter(Boolean);\n    embed.thumbnail = (_embedData$thumbnail$ = (_embedData$thumbnail = embedData.thumbnail) === null || _embedData$thumbnail === void 0 ? void 0 : _embedData$thumbnail.url) !== null && _embedData$thumbnail$ !== void 0 ? _embedData$thumbnail$ : \"\";\n    const color = _common_input_color_ColorModel__WEBPACK_IMPORTED_MODULE_0__[/* ColorModel */ \"a\"].create();\n    color.setRaw((_embedData$color = embedData.color) !== null && _embedData$color !== void 0 ? _embedData$color : null);\n    embed.color = color;\n    const fields = [];\n    embed.fields = fields;\n\n    for (const fieldData of (_embedData$fields = embedData.fields) !== null && _embedData$fields !== void 0 ? _embedData$fields : []) {\n      var _embedData$fields, _fieldData$name, _fieldData$value, _fieldData$inline;\n\n      const field = {};\n      fields.push(field);\n      field.name = (_fieldData$name = fieldData.name) !== null && _fieldData$name !== void 0 ? _fieldData$name : \"\";\n      field.value = (_fieldData$value = fieldData.value) !== null && _fieldData$value !== void 0 ? _fieldData$value : \"\";\n      field.inline = (_fieldData$inline = fieldData.inline) !== null && _fieldData$inline !== void 0 ? _fieldData$inline : false;\n    }\n  }\n\n  return snapshot;\n};\n\n/***/ }),\n\n/***/ \"uid3\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, \"BackupsModal\", function() { return /* binding */ BackupsModal; });\n\n// EXTERNAL MODULE: ./node_modules/react/jsx-runtime.js\nvar jsx_runtime = __webpack_require__(\"nKUr\");\n\n// EXTERNAL MODULE: ./node_modules/mobx-react-lite/es/index.js + 12 modules\nvar es = __webpack_require__(\"aoTL\");\n\n// EXTERNAL MODULE: ./node_modules/react/index.js\nvar react = __webpack_require__(\"q1tI\");\n\n// EXTERNAL MODULE: ./common/input/button/PrimaryButton.ts\nvar PrimaryButton = __webpack_require__(\"GyG+\");\n\n// EXTERNAL MODULE: ./common/input/button/SecondaryButton.ts\nvar SecondaryButton = __webpack_require__(\"JrLk\");\n\n// EXTERNAL MODULE: ./common/modal/layout/ModalAction.ts\nvar ModalAction = __webpack_require__(\"KpTw\");\n\n// EXTERNAL MODULE: ./common/modal/layout/ModalBody.ts\nvar ModalBody = __webpack_require__(\"LZrb\");\n\n// EXTERNAL MODULE: ./common/modal/layout/ModalContainer.ts\nvar ModalContainer = __webpack_require__(\"YmNt\");\n\n// EXTERNAL MODULE: ./common/modal/layout/ModalFooter.ts\nvar ModalFooter = __webpack_require__(\"g+2O\");\n\n// EXTERNAL MODULE: ./common/modal/layout/ModalHeader.ts\nvar ModalHeader = __webpack_require__(\"nGg0\");\n\n// EXTERNAL MODULE: ./common/modal/layout/ModalTitle.ts\nvar ModalTitle = __webpack_require__(\"mNbY\");\n\n// EXTERNAL MODULE: ./common/modal/ModalContext.ts\nvar ModalContext = __webpack_require__(\"xnAi\");\n\n// EXTERNAL MODULE: ./common/state/useLazyValue.ts\nvar useLazyValue = __webpack_require__(\"uEgJ\");\n\n// EXTERNAL MODULE: ./common/state/useRequiredContext.ts\nvar useRequiredContext = __webpack_require__(\"ytgV\");\n\n// EXTERNAL MODULE: ./icons/remove.tsx\nvar remove = __webpack_require__(\"eoCo\");\n\n// EXTERNAL MODULE: ./node_modules/next/node_modules/@babel/runtime/helpers/esm/initializerDefineProperty.js\nvar initializerDefineProperty = __webpack_require__(\"4nv/\");\n\n// EXTERNAL MODULE: ./node_modules/next/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor.js\nvar applyDecoratedDescriptor = __webpack_require__(\"EaFg\");\n\n// EXTERNAL MODULE: ./node_modules/next/node_modules/@babel/runtime/helpers/esm/initializerWarningHelper.js\nvar initializerWarningHelper = __webpack_require__(\"ACih\");\n\n// EXTERNAL MODULE: ./node_modules/mobx/lib/mobx.module.js\nvar mobx_module = __webpack_require__(\"2vnA\");\n\n// CONCATENATED MODULE: ./node_modules/idb/build/esm/wrap-idb-value.js\nconst instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst cursorRequestMap = new WeakMap();\nconst transactionDoneMap = new WeakMap();\nconst transactionStoreNamesMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    promise\n        .then((value) => {\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\n        // (see wrapFunction).\n        if (value instanceof IDBCursor) {\n            cursorRequestMap.set(value, request);\n        }\n        // Catching to avoid \"Uncaught Promise exceptions\"\n    })\n        .catch(() => { });\n    // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Polyfill for objectStoreNames because of Edge.\n            if (prop === 'objectStoreNames') {\n                return target.objectStoreNames || transactionStoreNamesMap.get(target);\n            }\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\n    if (func === IDBDatabase.prototype.transaction &&\n        !('objectStoreNames' in IDBTransaction.prototype)) {\n        return function (storeNames, ...args) {\n            const tx = func.call(unwrap(this), storeNames, ...args);\n            transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\n            return wrap(tx);\n        };\n    }\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(cursorRequestMap.get(this));\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\n\n\n// CONCATENATED MODULE: ./node_modules/idb/build/esm/index.js\n\n\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction));\n        });\n    }\n    if (blocked)\n        request.addEventListener('blocked', () => blocked());\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking)\n            db.addEventListener('versionchange', () => blocking());\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked)\n        request.addEventListener('blocked', () => blocked());\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        // Must reject if op rejects.\n        // If it's a write operation, must reject if tx.done rejects.\n        // Must reject with op rejection first.\n        // Must resolve with op value.\n        // Must handle both promises (no unhandled rejections)\n        return (await Promise.all([\n            target[targetFuncName](...args),\n            isWrite && tx.done,\n        ]))[0];\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\n\n\n// CONCATENATED MODULE: ./modules/database/connection/showUpgradeBlockedMessage.ts\nconst showUpgradeBlockedMessage = () => {\n  const container = document.createElement(\"div\");\n  container.id = \"db-upgrade-blocked\";\n  container.style.position = \"absolute\";\n  container.style.top = \"0\";\n  container.style.right = \"0\";\n  container.style.bottom = \"0\";\n  container.style.left = \"0\";\n  container.style.background = \"rgba(0, 0, 0, 0.85)\";\n  container.style.padding = \"16px\";\n  const header = document.createElement(\"h1\");\n  header.style.color = \"#ffffff\";\n  header.append(\"Discohook's local database needs an upgrade\");\n  const blockedMessage = document.createElement(\"p\");\n  blockedMessage.append(\"However, the upgrade can't proceed because there are older sessions of Discohook open.\");\n  const closeTabsMessage = document.createElement(\"p\");\n  closeTabsMessage.append(\"Please close all Discohook tabs before continuing.\");\n  container.append(header, blockedMessage, closeTabsMessage);\n  document.body.append(container);\n};\n// EXTERNAL MODULE: ./node_modules/next/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js + 1 modules\nvar objectWithoutProperties = __webpack_require__(\"dhJC\");\n\n// EXTERNAL MODULE: ./node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty.js\nvar defineProperty = __webpack_require__(\"cpVT\");\n\n// CONCATENATED MODULE: ./common/object/mapKeys.ts\nconst isObject = value => typeof value === \"object\" && value !== null;\n\nconst mapKeys = (object, fn) => {\n  if (Array.isArray(object)) {\n    return object.map(value => isObject(value) ? mapKeys(value, fn) : value);\n  }\n\n  const result = {};\n\n  for (const [key, value] of Object.entries(object)) {\n    if (isObject(value)) {\n      result[fn(key)] = mapKeys(value, fn);\n    } else {\n      result[fn(key)] = value;\n    }\n  }\n\n  return result;\n};\n// CONCATENATED MODULE: ./common/object/toSnakeCase.ts\n\nconst toSnakeCase = object => mapKeys(object, key => key.replace(/[A-Z]/g, match => `_${match.toLowerCase()}`));\n// CONCATENATED MODULE: ./modules/database/connection/upgradeDatabase.ts\n\n\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { Object(defineProperty[\"a\" /* default */])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n/* eslint-disable no-await-in-loop */\n\nconst upgradeDatabase = async (database, transaction, oldVersion) => {\n  if (oldVersion < 2 && oldVersion >= 1) {\n    let cursor = await transaction.objectStore(\"backups\").openCursor();\n\n    while (cursor) {\n      await cursor.update({\n        name: cursor.key,\n        message: cursor.value\n      });\n      cursor = await cursor.continue();\n    }\n  }\n\n  if (oldVersion < 3) {\n    database.createObjectStore(\"backup\", {\n      keyPath: \"id\",\n      autoIncrement: true\n    });\n    const backupStore = transaction.objectStore(\"backup\");\n    backupStore.createIndex(\"name\", \"name\", {\n      unique: true\n    });\n  }\n\n  if (oldVersion < 4 && oldVersion >= 1) {\n    const backupStore = transaction.objectStore(\"backup\");\n    const existingBackups = new Set();\n    let nameCursor = await backupStore.index(\"name\").openKeyCursor();\n\n    while (nameCursor) {\n      existingBackups.add(nameCursor.key);\n      nameCursor = await nameCursor.continue();\n    }\n\n    let cursor = await transaction.objectStore(\"backups\").openCursor();\n\n    while (cursor) {\n      if (!existingBackups.has(cursor.key)) {\n        await backupStore.put(_objectSpread(_objectSpread({}, cursor.value), {}, {\n          name: cursor.key,\n          message: toSnakeCase(cursor.value.message)\n        }));\n      }\n\n      cursor = await cursor.continue();\n    }\n  }\n\n  if (oldVersion < 5 && oldVersion >= 1) {\n    const backupStore = transaction.objectStore(\"backup\");\n    let cursor = await backupStore.openCursor();\n\n    while (cursor) {\n      const _cursor$value = cursor.value,\n            {\n        message\n      } = _cursor$value,\n            rest = Object(objectWithoutProperties[\"a\" /* default */])(_cursor$value, [\"message\"]);\n\n      await backupStore.put(_objectSpread(_objectSpread({}, rest), {}, {\n        messages: [message]\n      }));\n      cursor = await cursor.continue();\n    }\n  }\n\n  if (oldVersion < 6 && oldVersion >= 1) {\n    const backupStore = transaction.objectStore(\"backup\");\n    let cursor = await backupStore.openCursor();\n\n    while (cursor) {\n      const _cursor$value2 = cursor.value,\n            {\n        webhookUrl\n      } = _cursor$value2,\n            rest = Object(objectWithoutProperties[\"a\" /* default */])(_cursor$value2, [\"webhookUrl\"]);\n\n      await backupStore.put(_objectSpread(_objectSpread({}, rest), {}, {\n        target: {\n          url: webhookUrl\n        }\n      }));\n      cursor = await cursor.continue();\n    }\n  }\n\n  if (oldVersion < 9 && oldVersion >= 1) {\n    const backupStore = transaction.objectStore(\"backup\");\n    let cursor = await backupStore.openCursor();\n\n    while (cursor) {\n      const {\n        id,\n        name,\n        messages,\n        target\n      } = cursor.value;\n\n      if (name) {\n        await backupStore.put({\n          id,\n          name,\n          messages: messages.map(data => ({\n            data: \"data\" in data ? data.data : data,\n            reference: \"reference\" in data ? data.reference : target.message\n          })),\n          target: {\n            url: target.url\n          }\n        });\n      } else {\n        await backupStore.delete(id);\n      }\n\n      cursor = await cursor.continue();\n    }\n  }\n\n  if (oldVersion < 10 && oldVersion >= 1) {\n    const backupStore = transaction.objectStore(\"backup\");\n    let cursor = await backupStore.openCursor();\n\n    while (cursor) {\n      var _target$url;\n\n      const _cursor$value3 = cursor.value,\n            {\n        target\n      } = _cursor$value3,\n            backup = Object(objectWithoutProperties[\"a\" /* default */])(_cursor$value3, [\"target\"]);\n\n      await backupStore.put(_objectSpread(_objectSpread({}, backup), {}, {\n        targets: [{\n          url: (_target$url = target.url) !== null && _target$url !== void 0 ? _target$url : \"\"\n        }]\n      }));\n      cursor = await cursor.continue();\n    }\n  }\n};\n// CONCATENATED MODULE: ./modules/database/connection/openDatabase.ts\n\n\n\nconst openDatabase = async () => {\n  return openDB(\"discohook\", 10, {\n    upgrade: (database, oldVersion, newVersion, transaction) => {\n      // Casting to unknown schema, because upgrades shouldn't assume how the\n      // schema looks at that time\n      upgradeDatabase(database, transaction, oldVersion).then(() => {\n        var _document$querySelect;\n\n        localStorage.setItem(\"database-upgraded-version\", \"10\");\n        (_document$querySelect = document.querySelector(\"#db-upgrade-blocked\")) === null || _document$querySelect === void 0 ? void 0 : _document$querySelect.remove();\n      }).catch(error => {\n        console.error(\"Error on database upgrade:\", error);\n      });\n    },\n    blocked: showUpgradeBlockedMessage\n  });\n};\n// CONCATENATED MODULE: ./modules/database/DatabaseManager.ts\n\n\n\n\nvar _class, _descriptor, _descriptor2, _temp;\n\n\n\nlet DatabaseManager_DatabaseManager = (_class = (_temp = class DatabaseManager {\n  constructor() {\n    this.initialized = void 0;\n    this.database = void 0;\n\n    Object(initializerDefineProperty[\"a\" /* default */])(this, \"persisted\", _descriptor, this);\n\n    Object(initializerDefineProperty[\"a\" /* default */])(this, \"persistenceMessageDismissed\", _descriptor2, this);\n\n    let markAsInitialized;\n    this.initialized = new Promise(resolve => {\n      markAsInitialized = resolve;\n    });\n    if (false) {}\n\n    if (\"storage\" in navigator) {\n      navigator.storage.persisted().then(persisted => {\n        this.persisted = persisted;\n      }).catch(() => {});\n    }\n\n    openDatabase().then(database => {\n      this.database = database;\n      markAsInitialized();\n    }).catch(error => {\n      console.error(\"Failed to open database:\", error);\n    });\n  }\n\n  async requestPersistence() {\n    if (\"chrome\" in window) {\n      await Notification.requestPermission();\n    }\n\n    if (\"storage\" in navigator) {\n      this.persisted = await navigator.storage.persist();\n    }\n  }\n\n  get shouldShowPersistenceWarning() {\n    return !this.persisted && !this.persistenceMessageDismissed;\n  }\n\n}, _temp), (_descriptor = Object(applyDecoratedDescriptor[\"a\" /* default */])(_class.prototype, \"persisted\", [mobx_module[\"observable\"]], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return true;\n  }\n}), _descriptor2 = Object(applyDecoratedDescriptor[\"a\" /* default */])(_class.prototype, \"persistenceMessageDismissed\", [mobx_module[\"observable\"]], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return false;\n  }\n}), Object(applyDecoratedDescriptor[\"a\" /* default */])(_class.prototype, \"shouldShowPersistenceWarning\", [mobx_module[\"computed\"]], Object.getOwnPropertyDescriptor(_class.prototype, \"shouldShowPersistenceWarning\"), _class.prototype)), _class);\n// CONCATENATED MODULE: ./modules/database/DatabaseManagerContext.ts\n\nconst DatabaseManagerContext = /*#__PURE__*/Object(react[\"createContext\"])(null);\nDatabaseManagerContext.displayName = \"DatabaseManagerContext\";\nconst DatabaseManagerProvider = DatabaseManagerContext.Provider;\n// EXTERNAL MODULE: ./node_modules/styled-components/dist/styled-components.browser.esm.js\nvar styled_components_browser_esm = __webpack_require__(\"vOnD\");\n\n// EXTERNAL MODULE: ./common/layout/ButtonRow.ts\nvar ButtonRow = __webpack_require__(\"aNhp\");\n\n// EXTERNAL MODULE: ./common/modal/ModalManagerContext.tsx\nvar ModalManagerContext = __webpack_require__(\"+VeW\");\n\n// EXTERNAL MODULE: ./modules/markdown/Markdown.tsx + 44 modules\nvar Markdown = __webpack_require__(\"Kn7Z\");\n\n// CONCATENATED MODULE: ./modules/database/persist/PushNotificationModal.tsx\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction PushNotificationModal(props) {\n  const {\n    databaseManager\n  } = props;\n  const modal = Object(useRequiredContext[\"a\" /* useRequiredContext */])(ModalContext[\"a\" /* ModalContext */]);\n  return /*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(ModalContainer[\"a\" /* ModalContainer */], {\n    children: [/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(ModalHeader[\"a\" /* ModalHeader */], {\n      children: [/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(ModalTitle[\"a\" /* ModalTitle */], {\n        children: \"Notice\"\n      }), /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(ModalAction[\"a\" /* ModalAction */], {\n        icon: remove[\"a\" /* remove */],\n        label: \"Close\",\n        onClick: () => modal.dismiss()\n      })]\n    }), /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(ModalBody[\"a\" /* ModalBody */], {\n      children: /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(Markdown[\"a\" /* Markdown */], {\n        content: \"Chrome based browsers do not allow manual control of persistent\" + \" storage. As a workaround, you can grant this site permission to\" + \" send notifications to allow the site to use persistent storage.\"\n      })\n    }), /*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(ModalFooter[\"a\" /* ModalFooter */], {\n      children: [/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(SecondaryButton[\"a\" /* SecondaryButton */], {\n        onClick: () => modal.dismiss(),\n        children: \"Cancel\"\n      }), /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(PrimaryButton[\"a\" /* PrimaryButton */], {\n        onClick: async () => {\n          modal.dismiss();\n          await databaseManager.requestPersistence();\n        },\n        children: \"Request permission\"\n      })]\n    })]\n  });\n}\n// CONCATENATED MODULE: ./modules/database/persist/PersistentStorageWarning.tsx\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst Container = styled_components_browser_esm[\"d\" /* default */].div.withConfig({\n  componentId: \"sc-3x6mdx-0\"\n})([\"margin-top:16px;padding:16px;background:\", \";border-radius:3px;\"], ({\n  theme\n}) => theme.background.secondary);\nconst Header = styled_components_browser_esm[\"d\" /* default */].h5.withConfig({\n  componentId: \"sc-3x6mdx-1\"\n})([\"margin:0 0 8px;color:\", \";font-size:1em;font-weight:500;line-height:1.375;\"], ({\n  theme\n}) => theme.header.primary);\nconst Buttons = Object(styled_components_browser_esm[\"d\" /* default */])(ButtonRow[\"a\" /* ButtonRow */]).withConfig({\n  componentId: \"sc-3x6mdx-2\"\n})([\"margin-top:16px;\"]);\nfunction PersistentStorageWarning() {\n  const modalManager = Object(useRequiredContext[\"a\" /* useRequiredContext */])(ModalManagerContext[\"a\" /* ModalManagerContext */]);\n  const databaseManager = Object(useRequiredContext[\"a\" /* useRequiredContext */])(DatabaseManagerContext);\n  return Object(es[\"b\" /* useObserver */])(() => /*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(Container, {\n    children: [/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(Header, {\n      children: \"Warning\"\n    }), /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(Markdown[\"a\" /* Markdown */], {\n      content: \"Your browser did not grant permission to use persistent storage\" + \" for this site. Data stored might be deleted by the browser when\" + \" this permission is not granted.\"\n    }), /*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(Buttons, {\n      children: [/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(PrimaryButton[\"a\" /* PrimaryButton */], {\n        onClick: async () => {\n          if (\"chrome\" in window) {\n            modalManager.spawn({\n              render: () => /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(PushNotificationModal, {\n                databaseManager: databaseManager\n              })\n            });\n          } else {\n            await databaseManager.requestPersistence();\n          }\n        },\n        children: \"Request permission\"\n      }), /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(SecondaryButton[\"a\" /* SecondaryButton */], {\n        onClick: () => {\n          databaseManager.persistenceMessageDismissed = true;\n        },\n        children: \"Dismiss\"\n      })]\n    })]\n  }));\n}\n// CONCATENATED MODULE: ./common/dom/downloadBlob.ts\nconst downloadBlob = (blob, name) => {\n  const url = URL.createObjectURL(blob);\n  const anchor = document.createElement(\"a\");\n  document.body.append(anchor);\n  anchor.href = url;\n  anchor.download = name;\n  anchor.click();\n  anchor.remove();\n  URL.revokeObjectURL(url);\n};\n// EXTERNAL MODULE: ./modules/message/helpers/messageOf.ts\nvar messageOf = __webpack_require__(\"QcNg\");\n\n// CONCATENATED MODULE: ./modules/database/backup/BackupManager.ts\n\n\n\n\n\n\nvar BackupManager_class, BackupManager_descriptor, BackupManager_temp;\n\nfunction BackupManager_ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction BackupManager_objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { BackupManager_ownKeys(Object(source), true).forEach(function (key) { Object(defineProperty[\"a\" /* default */])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { BackupManager_ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n/* eslint-disable no-await-in-loop */\n\n\n\n\nlet BackupManager_BackupManager = (BackupManager_class = (BackupManager_temp = class BackupManager {\n  constructor(databaseManager, editorManager) {\n    this.databaseManager = void 0;\n    this.editorManager = void 0;\n\n    Object(initializerDefineProperty[\"a\" /* default */])(this, \"backups\", BackupManager_descriptor, this);\n\n    this.databaseManager = databaseManager;\n    this.editorManager = editorManager;\n    databaseManager.initialized.then(async () => {\n      await this.loadBackupList();\n    }).catch(() => {});\n  }\n\n  async loadBackupList() {\n    const backups = [];\n    let cursor = await this.databaseManager.database.transaction(\"backup\").objectStore(\"backup\").index(\"name\").openKeyCursor();\n\n    while (cursor) {\n      backups.push({\n        id: cursor.primaryKey,\n        name: cursor.key\n      });\n      cursor = await cursor.continue();\n    }\n\n    Object(mobx_module[\"runInAction\"])(() => {\n      this.backups = backups;\n    });\n  }\n\n  async getId(name) {\n    return this.databaseManager.database.transaction(\"backup\").objectStore(\"backup\").index(\"name\").getKey(name);\n  }\n\n  async loadBackup(name) {\n    const backup = await this.databaseManager.database.transaction(\"backup\").objectStore(\"backup\").index(\"name\").get(name);\n    if (!backup) return;\n    this.editorManager.set(\"messages\", backup.messages.map((_ref) => {\n      let {\n        data\n      } = _ref,\n          message = Object(objectWithoutProperties[\"a\" /* default */])(_ref, [\"data\"]);\n\n      return BackupManager_objectSpread(BackupManager_objectSpread({}, Object(messageOf[\"a\" /* messageOf */])(data)), message);\n    }));\n    this.editorManager.set(\"targets\", backup.targets);\n\n    for (const target of this.editorManager.targets) {\n      target.fetch().catch(() => {});\n    }\n  }\n\n  async saveBackup(backup) {\n    if (typeof backup === \"string\") {\n      const id = await this.getId(backup);\n      backup = {\n        id,\n        name: backup,\n        messages: this.editorManager.messages.map(message => ({\n          data: BackupManager_objectSpread(BackupManager_objectSpread({}, message.data), {}, {\n            files: undefined\n          }),\n          reference: message.reference\n        })),\n        targets: this.editorManager.targets.map(target => ({\n          url: target.url\n        }))\n      };\n    } else {\n      backup = BackupManager_objectSpread(BackupManager_objectSpread({}, backup), {}, {\n        id: await this.getId(backup.name)\n      });\n    }\n\n    if (!backup.id) delete backup.id;\n    await this.databaseManager.database.transaction(\"backup\", \"readwrite\").objectStore(\"backup\").put(backup);\n    await this.loadBackupList();\n  }\n\n  async deleteBackup(name) {\n    const id = await this.getId(name);\n    if (!id) return;\n    await this.databaseManager.database.transaction(\"backup\", \"readwrite\").objectStore(\"backup\").delete(id);\n    await this.loadBackupList();\n  }\n\n  async exportBackup(name) {\n    const backup = await this.databaseManager.database.transaction(\"backup\").objectStore(\"backup\").index(\"name\").get(name);\n    if (!backup) return;\n    const backupData = {\n      version: 7,\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      backups: [backup].map((_ref2) => {\n        let {\n          id\n        } = _ref2,\n            backup = Object(objectWithoutProperties[\"a\" /* default */])(_ref2, [\"id\"]);\n\n        return backup;\n      })\n    };\n    const blob = new Blob([JSON.stringify(backupData, undefined, 2), \"\\n\"], {\n      type: \"application/json\"\n    });\n    downloadBlob(blob, `${name}.json`);\n  }\n\n  async exportAll() {\n    const backups = [];\n    let cursor = await this.databaseManager.database.transaction(\"backup\").objectStore(\"backup\").openCursor();\n\n    while (cursor) {\n      backups.push(BackupManager_objectSpread(BackupManager_objectSpread({}, cursor.value), {}, {\n        id: undefined\n      }));\n      cursor = await cursor.continue();\n    }\n\n    const backupData = {\n      version: 7,\n      backups\n    };\n    const blob = new Blob([JSON.stringify(backupData, undefined, 2), \"\\n\"], {\n      type: \"application/json\"\n    });\n    downloadBlob(blob, \"backups.json\");\n  }\n\n  async getSafeBackupName(name) {\n    if (!(await this.getId(name))) {\n      return name;\n    }\n\n    for (let number = 1; true; number++) {\n      const proposedName = `${name} (${number})`;\n\n      if (!(await this.getId(proposedName))) {\n        return proposedName;\n      }\n    }\n  }\n\n  async importBackups(blob) {\n    let exportData = JSON.parse(await blob.text());\n\n    switch (exportData.version) {\n      case 1:\n      case 2:\n        {\n          exportData = {\n            version: 3,\n            backups: [{\n              name: exportData.name,\n              message: toSnakeCase(exportData.message)\n            }]\n          };\n        }\n      // falls through\n\n      case 3:\n        {\n          exportData = {\n            version: 4,\n            backups: exportData.backups.map((_ref3) => {\n              let {\n                message\n              } = _ref3,\n                  backup = Object(objectWithoutProperties[\"a\" /* default */])(_ref3, [\"message\"]);\n\n              return BackupManager_objectSpread(BackupManager_objectSpread({}, backup), {}, {\n                messages: [message]\n              });\n            })\n          };\n        }\n      // falls through\n\n      case 4:\n        exportData = {\n          version: 5,\n          backups: exportData.backups.map((_ref4) => {\n            let {\n              webhookUrl\n            } = _ref4,\n                backup = Object(objectWithoutProperties[\"a\" /* default */])(_ref4, [\"webhookUrl\"]);\n\n            return BackupManager_objectSpread(BackupManager_objectSpread({}, backup), {}, {\n              target: {\n                url: webhookUrl\n              }\n            });\n          })\n        };\n      // falls through\n\n      case 5:\n        exportData = {\n          version: 6,\n          backups: exportData.backups.map((_ref5) => {\n            let {\n              messages,\n              target\n            } = _ref5,\n                backup = Object(objectWithoutProperties[\"a\" /* default */])(_ref5, [\"messages\", \"target\"]);\n\n            return BackupManager_objectSpread(BackupManager_objectSpread({}, backup), {}, {\n              messages: messages.map(data => ({\n                data,\n                reference: target.message\n              })),\n              target: {\n                url: target.url\n              }\n            });\n          })\n        };\n      // falls through\n\n      case 6:\n        exportData = {\n          version: 7,\n          backups: exportData.backups.map((_ref6) => {\n            var _target$url;\n\n            let {\n              target\n            } = _ref6,\n                backup = Object(objectWithoutProperties[\"a\" /* default */])(_ref6, [\"target\"]);\n\n            return BackupManager_objectSpread(BackupManager_objectSpread({}, backup), {}, {\n              targets: [{\n                url: (_target$url = target.url) !== null && _target$url !== void 0 ? _target$url : \"\"\n              }]\n            });\n          })\n        };\n      // falls through\n\n      case 7:\n        for (const backup of exportData.backups) {\n          await this.saveBackup(BackupManager_objectSpread(BackupManager_objectSpread({}, backup), {}, {\n            name: await this.getSafeBackupName(backup.name),\n            id: undefined\n          }));\n        }\n\n    }\n  }\n\n}, BackupManager_temp), (BackupManager_descriptor = Object(applyDecoratedDescriptor[\"a\" /* default */])(BackupManager_class.prototype, \"backups\", [mobx_module[\"observable\"]], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return [];\n  }\n})), BackupManager_class);\n// CONCATENATED MODULE: ./modules/database/backup/BackupManagerContext.ts\n\nconst BackupManagerContext = /*#__PURE__*/Object(react[\"createContext\"])(null);\nBackupManagerContext.displayName = \"BackupManagerContext\";\nconst BackupManagerProvider = BackupManagerContext.Provider;\n// EXTERNAL MODULE: ./common/input/text/InputField.tsx + 1 modules\nvar InputField = __webpack_require__(\"8bSZ\");\n\n// CONCATENATED MODULE: ./modules/database/backup/modal/BackupCreationControls.tsx\n\n\n\n\n\n\n\nfunction BackupCreationControls() {\n  const backupManager = Object(useRequiredContext[\"a\" /* useRequiredContext */])(BackupManagerContext);\n  const {\n    0: backupName,\n    1: setBackupName\n  } = Object(react[\"useState\"])(\"\");\n  return Object(es[\"b\" /* useObserver */])(() => /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(InputField[\"a\" /* InputField */], {\n    id: \"backup-name\",\n    value: backupName,\n    onChange: setBackupName,\n    label: \"Backup name\",\n    children: /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(PrimaryButton[\"a\" /* PrimaryButton */], {\n      disabled: backupName.length === 0,\n      onClick: async () => {\n        await backupManager.saveBackup(backupName.trim());\n        setBackupName(\"\");\n      },\n      children: backupManager.backups.some(backup => backup.name === backupName.trim()) ? \"Overwrite\" : \"Save\"\n    })\n  }));\n}\n// EXTERNAL MODULE: ./node_modules/polished/dist/polished.esm.js + 10 modules\nvar polished_esm = __webpack_require__(\"ufqH\");\n\n// EXTERNAL MODULE: ./common/input/button/Button.ts\nvar Button = __webpack_require__(\"AFXh\");\n\n// EXTERNAL MODULE: ./common/layout/ActionButtons.tsx + 2 modules\nvar ActionButtons = __webpack_require__(\"MKkt\");\n\n// EXTERNAL MODULE: ./icons/copy.tsx\nvar copy = __webpack_require__(\"C8f0\");\n\n// CONCATENATED MODULE: ./icons/save.tsx\n\n\nconst save = /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"svg\", {\n  width: \"16\",\n  height: \"16\",\n  viewBox: \"0 0 16 16\",\n  fill: \"none\",\n  children: /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"path\", {\n    d: \"M11 15V9H5V15M5 1L4.99999 5H10M13.6667 15H2.33333C1.97971 15 1.64057 14.8595 1.39052 14.6095C1.14048 14.3594 1 14.0203 1 13.6667V2.33333C1 1.97971 1.14048 1.64057 1.39052 1.39052C1.64057 1.14048 1.97971 1 2.33333 1H11.6667L15 4.33333V13.6667C15 14.0203 14.8595 14.3594 14.6095 14.6095C14.3594 14.8595 14.0203 15 13.6667 15Z\",\n    stroke: \"currentColor\",\n    strokeWidth: \"2\",\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\"\n  })\n});\n// CONCATENATED MODULE: ./icons/trash.tsx\n\n\nconst trash = /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"svg\", {\n  width: \"16\",\n  height: \"16\",\n  viewBox: \"0 0 16 16\",\n  fill: \"none\",\n  children: /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"path\", {\n    d: \"M1 4L2.99999 3.99998M2.99999 3.99998V13.5C2.99999 14.3284 3.67156 15 4.49999 15L11.5 15C12.3284 15 13 14.3284 13 13.5V4M2.99999 3.99998H5.33333M13 4H15M13 4L10.6667 3.99998M5.33333 3.99998V2.5C5.33333 1.67157 6.00491 1 6.83333 1H9.16667C9.99509 1 10.6667 1.67157 10.6667 2.5V3.99998M5.33333 3.99998H10.6667\",\n    stroke: \"currentColor\",\n    strokeWidth: \"2\",\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\"\n  })\n});\n// CONCATENATED MODULE: ./icons/upload.tsx\n\n\nconst upload = /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"svg\", {\n  width: \"16\",\n  height: \"16\",\n  viewBox: \"0 0 16 16\",\n  fill: \"none\",\n  children: /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"path\", {\n    d: \"M14 10V12.6667C14 13.0203 13.8595 13.3594 13.6095 13.6095C13.3594 13.8595 13.0203 14 12.6667 14H3.33333C2.97971 14 2.64057 13.8595 2.39052 13.6095C2.14048 13.3594 2 13.0203 2 12.6667V10M4.66667 5.33333L8 2M8 2L11.3333 5.33333M8 2V10\",\n    stroke: \"currentColor\",\n    strokeWidth: \"2\",\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\"\n  })\n});\n// CONCATENATED MODULE: ./modules/database/backup/modal/DeletionConfirmationModal.tsx\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction DeletionConfirmationModal(props) {\n  const {\n    backupManager,\n    backup\n  } = props;\n  const modal = Object(useRequiredContext[\"a\" /* useRequiredContext */])(ModalContext[\"a\" /* ModalContext */]);\n  return Object(es[\"b\" /* useObserver */])(() => /*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(ModalContainer[\"a\" /* ModalContainer */], {\n    children: [/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(ModalHeader[\"a\" /* ModalHeader */], {\n      children: [/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(ModalTitle[\"a\" /* ModalTitle */], {\n        children: \"Delete Backup\"\n      }), /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(ModalAction[\"a\" /* ModalAction */], {\n        icon: remove[\"a\" /* remove */],\n        label: \"Close\",\n        onClick: () => modal.dismiss()\n      })]\n    }), /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(ModalBody[\"a\" /* ModalBody */], {\n      children: /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(Markdown[\"a\" /* Markdown */], {\n        content: `Are you sure you want to delete \"${backup.name}\"? This action` + \" cannot be undone.\"\n      })\n    }), /*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(ModalFooter[\"a\" /* ModalFooter */], {\n      children: [/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(SecondaryButton[\"a\" /* SecondaryButton */], {\n        onClick: () => modal.dismiss(),\n        children: \"Cancel\"\n      }), /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(PrimaryButton[\"a\" /* PrimaryButton */], {\n        onClick: async () => {\n          await backupManager.deleteBackup(backup.name);\n          modal.dismiss();\n        },\n        children: \"Delete\"\n      })]\n    })]\n  }));\n}\n// CONCATENATED MODULE: ./modules/database/backup/modal/BackupItem.tsx\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst BackupItem_Container = styled_components_browser_esm[\"d\" /* default */].li.withConfig({\n  componentId: \"sc-4y1qwg-0\"\n})([\"height:48px;display:flex;align-items:center;list-style:none;border:0 solid \", \";& + &{border-top-width:1px;}& > \", \"{margin:0;}\"], ({\n  theme\n}) => theme.backgroundModifier.accent, Button[\"a\" /* Button */]);\nconst BackupName = styled_components_browser_esm[\"d\" /* default */].div.withConfig({\n  componentId: \"sc-4y1qwg-1\"\n})([\"\", \";flex:1;font-weight:500;\"], Object(polished_esm[\"b\" /* ellipsis */])());\nfunction BackupItem(props) {\n  const {\n    backup\n  } = props;\n  const modalManager = Object(useRequiredContext[\"a\" /* useRequiredContext */])(ModalManagerContext[\"a\" /* ModalManagerContext */]);\n  const backupManager = Object(useRequiredContext[\"a\" /* useRequiredContext */])(BackupManagerContext);\n  return Object(es[\"b\" /* useObserver */])(() => /*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(BackupItem_Container, {\n    children: [/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(BackupName, {\n      children: backup.name\n    }), /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(ActionButtons[\"a\" /* ActionButtons */], {\n      actions: [{\n        icon: upload,\n        label: \"Load\",\n        handler: async () => backupManager.loadBackup(backup.name)\n      }, {\n        icon: save,\n        label: \"Export\",\n        handler: async () => backupManager.exportBackup(backup.name),\n        overflow: true\n      }, {\n        icon: copy[\"a\" /* copy */],\n        label: \"Overwrite\",\n        handler: async () => backupManager.saveBackup(backup.name),\n        overflow: true\n      }, {\n        icon: trash,\n        label: \"Delete\",\n        handler: () => modalManager.spawn({\n          render: () => /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(DeletionConfirmationModal, {\n            backupManager: backupManager,\n            backup: backup\n          })\n        }),\n        overflow: true\n      }]\n    })]\n  }));\n}\n// CONCATENATED MODULE: ./modules/database/backup/modal/BackupList.tsx\n\n\n\n\n\n\n\n\n\n\n\nconst BackupList_Container = styled_components_browser_esm[\"d\" /* default */].ul.withConfig({\n  componentId: \"sc-1bbv68x-0\"\n})([\"padding:0;margin:0;max-height:420px;overflow-x:hidden;\"]);\nfunction BackupList() {\n  const backupManager = Object(useRequiredContext[\"a\" /* useRequiredContext */])(BackupManagerContext);\n  const {\n    0: search,\n    1: setSearch\n  } = Object(react[\"useState\"])(\"\");\n  return Object(es[\"b\" /* useObserver */])(() => backupManager.backups.length > 0 ? /*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(jsx_runtime[\"Fragment\"], {\n    children: [/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(InputField[\"a\" /* InputField */], {\n      id: \"backups-search\",\n      label: \"Search Backups\",\n      value: search,\n      onChange: setSearch\n    }), /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(BackupList_Container, {\n      children: backupManager.backups.filter(backup => backup.name.toLocaleLowerCase().includes(search.toLocaleLowerCase())).map(backup => /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(BackupItem, {\n        backup: backup\n      }, backup.id))\n    })]\n  }) : /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(Markdown[\"a\" /* Markdown */], {\n    content: \"You haven't made any backups yet.\" + \" Enter a name below and click on the Save button to make one.\"\n  }));\n}\n// CONCATENATED MODULE: ./modules/database/backup/modal/BackupsModal.tsx\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction BackupsModal(props) {\n  const {\n    editorManager\n  } = props;\n  const databaseManager = Object(useLazyValue[\"a\" /* useLazyValue */])(() => new DatabaseManager_DatabaseManager());\n  const backupManager = Object(useLazyValue[\"a\" /* useLazyValue */])(() => new BackupManager_BackupManager(databaseManager, editorManager));\n  const modal = Object(useRequiredContext[\"a\" /* useRequiredContext */])(ModalContext[\"a\" /* ModalContext */]);\n  const fileInputRef = Object(react[\"useRef\"])(null);\n  return Object(es[\"b\" /* useObserver */])(() => /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(DatabaseManagerProvider, {\n    value: databaseManager,\n    children: /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(BackupManagerProvider, {\n      value: backupManager,\n      children: /*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(ModalContainer[\"a\" /* ModalContainer */], {\n        children: [/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"input\", {\n          ref: fileInputRef,\n          type: \"file\",\n          style: {\n            display: \"none\"\n          },\n          onChange: async event => {\n            var _event$target$files, _event$target$files$i;\n\n            const file = (_event$target$files = event.target.files) === null || _event$target$files === void 0 ? void 0 : (_event$target$files$i = _event$target$files.item(0)) === null || _event$target$files$i === void 0 ? void 0 : _event$target$files$i.slice();\n            event.target.files = null;\n\n            if (file) {\n              await backupManager.importBackups(file);\n            }\n          }\n        }), /*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(ModalHeader[\"a\" /* ModalHeader */], {\n          children: [/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(ModalTitle[\"a\" /* ModalTitle */], {\n            children: \"Backups\"\n          }), /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(ModalAction[\"a\" /* ModalAction */], {\n            icon: remove[\"a\" /* remove */],\n            label: \"Close\",\n            onClick: () => modal.dismiss()\n          })]\n        }), databaseManager.shouldShowPersistenceWarning && /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(ModalBody[\"a\" /* ModalBody */], {\n          children: /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(PersistentStorageWarning, {})\n        }), /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(ModalBody[\"a\" /* ModalBody */], {\n          children: /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(BackupList, {})\n        }), /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(ModalBody[\"a\" /* ModalBody */], {\n          children: /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(BackupCreationControls, {})\n        }), /*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(ModalFooter[\"a\" /* ModalFooter */], {\n          children: [/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(SecondaryButton[\"a\" /* SecondaryButton */], {\n            onClick: async () => backupManager.exportAll(),\n            children: \"Export All\"\n          }), /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(SecondaryButton[\"a\" /* SecondaryButton */], {\n            onClick: () => {\n              var _fileInputRef$current;\n\n              return (_fileInputRef$current = fileInputRef.current) === null || _fileInputRef$current === void 0 ? void 0 : _fileInputRef$current.click();\n            },\n            children: \"Import\"\n          }), /*#__PURE__*/Object(jsx_runtime[\"jsx\"])(PrimaryButton[\"a\" /* PrimaryButton */], {\n            onClick: () => modal.dismiss(),\n            children: \"Close\"\n          })]\n        })]\n      })\n    })\n  }));\n}\n\n/***/ })\n\n}]);","inputSourceMap":{"version":3,"sources":["/home/runner/work/site/site/node_modules/next/node_modules/@babel/runtime/helpers/esm/initializerDefineProperty.js","/home/runner/work/site/site/node_modules/next/node_modules/@babel/runtime/helpers/esm/initializerWarningHelper.js","/home/runner/work/site/site/node_modules/next/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor.js","/home/runner/work/site/site/modules/message/helpers/messageOf.ts","/home/runner/work/site/site/node_modules/idb/build/esm/wrap-idb-value.js","/home/runner/work/site/site/node_modules/idb/build/esm/index.js","/home/runner/work/site/site/modules/database/connection/showUpgradeBlockedMessage.ts","/home/runner/work/site/site/common/object/mapKeys.ts","/home/runner/work/site/site/common/object/toSnakeCase.ts","/home/runner/work/site/site/modules/database/connection/upgradeDatabase.ts","/home/runner/work/site/site/modules/database/connection/openDatabase.ts","/home/runner/work/site/site/modules/database/DatabaseManager.ts","/home/runner/work/site/site/modules/database/DatabaseManagerContext.ts","/home/runner/work/site/site/modules/database/persist/PushNotificationModal.tsx","/home/runner/work/site/site/modules/database/persist/PersistentStorageWarning.tsx","/home/runner/work/site/site/common/dom/downloadBlob.ts","/home/runner/work/site/site/modules/database/backup/BackupManager.ts","/home/runner/work/site/site/modules/database/backup/BackupManagerContext.ts","/home/runner/work/site/site/modules/database/backup/modal/BackupCreationControls.tsx","/home/runner/work/site/site/icons/save.tsx","/home/runner/work/site/site/icons/trash.tsx","/home/runner/work/site/site/icons/upload.tsx","/home/runner/work/site/site/modules/database/backup/modal/DeletionConfirmationModal.tsx","/home/runner/work/site/site/modules/database/backup/modal/BackupItem.tsx","/home/runner/work/site/site/modules/database/backup/modal/BackupList.tsx","/home/runner/work/site/site/modules/database/backup/modal/BackupsModal.tsx"],"names":["messageOf","data","snapshot","content","username","avatar","avatar_url","embeds","embedData","embed","length","undefined","url","gallery","image","push","title","description","author","name","authorUrl","authorIcon","icon_url","footer","text","footerIcon","timestamp","Date","Number","NaN","filter","Boolean","thumbnail","color","ColorModel","create","setRaw","fields","fieldData","field","value","inline","showUpgradeBlockedMessage","container","document","createElement","id","style","position","top","right","bottom","left","background","padding","header","append","blockedMessage","closeTabsMessage","body","isObject","mapKeys","object","fn","Array","isArray","map","result","key","Object","entries","toSnakeCase","replace","match","toLowerCase","upgradeDatabase","database","transaction","oldVersion","cursor","objectStore","openCursor","update","message","continue","createObjectStore","keyPath","autoIncrement","backupStore","createIndex","unique","existingBackups","Set","nameCursor","index","openKeyCursor","add","has","put","rest","messages","webhookUrl","target","reference","delete","backup","targets","openDatabase","openDB","upgrade","newVersion","then","localStorage","setItem","querySelector","remove","catch","error","console","blocked","DatabaseManager","constructor","initialized","markAsInitialized","Promise","resolve","navigator","storage","persisted","requestPersistence","window","Notification","requestPermission","persist","shouldShowPersistenceWarning","persistenceMessageDismissed","observable","computed","DatabaseManagerContext","createContext","displayName","DatabaseManagerProvider","Provider","PushNotificationModal","props","databaseManager","modal","useRequiredContext","ModalContext","dismiss","Container","styled","div","theme","secondary","Header","h5","primary","Buttons","ButtonRow","PersistentStorageWarning","modalManager","ModalManagerContext","useObserver","spawn","render","downloadBlob","blob","URL","createObjectURL","anchor","href","download","click","revokeObjectURL","BackupManager","editorManager","loadBackupList","backups","primaryKey","runInAction","getId","getKey","loadBackup","get","set","fetch","saveBackup","files","deleteBackup","exportBackup","backupData","version","Blob","JSON","stringify","type","exportAll","getSafeBackupName","number","proposedName","importBackups","exportData","parse","BackupManagerContext","BackupManagerProvider","BackupCreationControls","backupManager","backupName","setBackupName","useState","trim","some","save","trash","upload","DeletionConfirmationModal","li","backgroundModifier","accent","Button","BackupName","ellipsis","BackupItem","icon","label","handler","overflow","copy","ul","BackupList","search","setSearch","toLocaleLowerCase","includes","BackupsModal","useLazyValue","fileInputRef","useRef","display","event","file","item","slice","current"],"mappings":"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CAoB,WAAK,CAACC,KAAN,uBAAcF,SAAS,CAACE,KAAxB,+DAAiC,EAAjC;AACAD,WAAK,CAACE,MAAN,wBAAeH,SAAS,CAACG,MAAzB,iEAAmC,KAAnC;AACD;AACF;;AAED,SAAOvC,QAAP;AACD,CAvDM,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACLP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,sBAAsB,EAAE;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEqG;;;ACxLlC;A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","file":"x","sourcesContent":["export default function _initializerDefineProperty(target, property, descriptor, context) {\n  if (!descriptor) return;\n  Object.defineProperty(target, property, {\n    enumerable: descriptor.enumerable,\n    configurable: descriptor.configurable,\n    writable: descriptor.writable,\n    value: descriptor.initializer ? descriptor.initializer.call(context) : void 0\n  });\n}","export default function _initializerWarningHelper(descriptor, context) {\n  throw new Error('Decorating class property failed. Please ensure that ' + 'proposal-class-properties is enabled and runs after the decorators transform.');\n}","export default function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {\n  var desc = {};\n  Object.keys(descriptor).forEach(function (key) {\n    desc[key] = descriptor[key];\n  });\n  desc.enumerable = !!desc.enumerable;\n  desc.configurable = !!desc.configurable;\n\n  if ('value' in desc || desc.initializer) {\n    desc.writable = true;\n  }\n\n  desc = decorators.slice().reverse().reduce(function (desc, decorator) {\n    return decorator(target, property, desc) || desc;\n  }, desc);\n\n  if (context && desc.initializer !== void 0) {\n    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n    desc.initializer = undefined;\n  }\n\n  if (desc.initializer === void 0) {\n    Object.defineProperty(target, property, desc);\n    desc = null;\n  }\n\n  return desc;\n}","import type { SnapshotIn } from \"mobx-state-tree\"\nimport { ColorModel } from \"../../../common/input/color/ColorModel\"\nimport type { MessageData } from \"../state/data/MessageData\"\nimport type { MessageModel } from \"../state/models/MessageModel\"\n\nexport const messageOf = (data: MessageData) => {\n  const snapshot: Record<string, unknown> = {}\n\n  snapshot.content = data.content ?? \"\"\n  snapshot.username = data.username ?? \"\"\n  snapshot.avatar = data.avatar_url ?? \"\"\n\n  const embeds: Record<string, unknown>[] = []\n  snapshot.embeds = embeds\n\n  for (const embedData of data.embeds ?? []) {\n    let embed = embeds.length > 0 ? embeds[embeds.length - 1] : undefined\n\n    if (embed?.url && embed.url === embedData.url) {\n      const gallery = embed.gallery as string[]\n      if (embedData.image?.url && gallery.length < 4) {\n        gallery.push(embedData.image.url)\n      }\n\n      continue\n    }\n\n    embed = {}\n    embeds.push(embed)\n\n    embed.title = embedData.title ?? \"\"\n    embed.description = embedData.description ?? \"\"\n    embed.url = embedData.url ?? \"\"\n    embed.author = embedData.author?.name ?? \"\"\n    embed.authorUrl = embedData.author?.url ?? \"\"\n    embed.authorIcon = embedData.author?.icon_url ?? \"\"\n    embed.footer = embedData.footer?.text ?? \"\"\n    embed.footerIcon = embedData.footer?.icon_url ?? \"\"\n    embed.timestamp = new Date(embedData.timestamp ?? Number.NaN)\n    embed.gallery = [embedData.image?.url ?? \"\"].filter(Boolean)\n    embed.thumbnail = embedData.thumbnail?.url ?? \"\"\n\n    const color = ColorModel.create()\n    color.setRaw(embedData.color ?? null)\n    embed.color = color\n\n    const fields: Record<string, unknown>[] = []\n    embed.fields = fields\n\n    for (const fieldData of embedData.fields ?? []) {\n      const field: Record<string, unknown> = {}\n      fields.push(field)\n\n      field.name = fieldData.name ?? \"\"\n      field.value = fieldData.value ?? \"\"\n      field.inline = fieldData.inline ?? false\n    }\n  }\n\n  return snapshot as SnapshotIn<typeof MessageModel>\n}\n","const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst cursorRequestMap = new WeakMap();\nconst transactionDoneMap = new WeakMap();\nconst transactionStoreNamesMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    promise\n        .then((value) => {\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\n        // (see wrapFunction).\n        if (value instanceof IDBCursor) {\n            cursorRequestMap.set(value, request);\n        }\n        // Catching to avoid \"Uncaught Promise exceptions\"\n    })\n        .catch(() => { });\n    // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Polyfill for objectStoreNames because of Edge.\n            if (prop === 'objectStoreNames') {\n                return target.objectStoreNames || transactionStoreNamesMap.get(target);\n            }\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\n    if (func === IDBDatabase.prototype.transaction &&\n        !('objectStoreNames' in IDBTransaction.prototype)) {\n        return function (storeNames, ...args) {\n            const tx = func.call(unwrap(this), storeNames, ...args);\n            transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\n            return wrap(tx);\n        };\n    }\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(cursorRequestMap.get(this));\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\nexport { reverseTransformCache as a, instanceOfAny as i, replaceTraps as r, unwrap as u, wrap as w };\n","import { w as wrap, r as replaceTraps } from './wrap-idb-value.js';\nexport { u as unwrap, w as wrap } from './wrap-idb-value.js';\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction));\n        });\n    }\n    if (blocked)\n        request.addEventListener('blocked', () => blocked());\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking)\n            db.addEventListener('versionchange', () => blocking());\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked)\n        request.addEventListener('blocked', () => blocked());\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        // Must reject if op rejects.\n        // If it's a write operation, must reject if tx.done rejects.\n        // Must reject with op rejection first.\n        // Must resolve with op value.\n        // Must handle both promises (no unhandled rejections)\n        return (await Promise.all([\n            target[targetFuncName](...args),\n            isWrite && tx.done,\n        ]))[0];\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nexport { deleteDB, openDB };\n","export const showUpgradeBlockedMessage = () => {\n  const container = document.createElement(\"div\")\n  container.id = \"db-upgrade-blocked\"\n  container.style.position = \"absolute\"\n  container.style.top = \"0\"\n  container.style.right = \"0\"\n  container.style.bottom = \"0\"\n  container.style.left = \"0\"\n  container.style.background = \"rgba(0, 0, 0, 0.85)\"\n  container.style.padding = \"16px\"\n\n  const header = document.createElement(\"h1\")\n  header.style.color = \"#ffffff\"\n  header.append(\"Discohook's local database needs an upgrade\")\n\n  const blockedMessage = document.createElement(\"p\")\n  blockedMessage.append(\n    \"However, the upgrade can't proceed because there are older sessions of Discohook open.\",\n  )\n\n  const closeTabsMessage = document.createElement(\"p\")\n  closeTabsMessage.append(\"Please close all Discohook tabs before continuing.\")\n\n  container.append(header, blockedMessage, closeTabsMessage)\n  document.body.append(container)\n}\n","const isObject = (value: unknown) => typeof value === \"object\" && value !== null\n\nexport const mapKeys = (\n  object: unknown,\n  fn: (key: string) => string,\n): Record<string, unknown> | unknown[] => {\n  if (Array.isArray(object)) {\n    return object.map(value => (isObject(value) ? mapKeys(value, fn) : value))\n  }\n\n  const result: Record<string, unknown> = {}\n\n  for (const [key, value] of Object.entries(\n    object as Record<string, unknown>,\n  )) {\n    if (isObject(value)) {\n      result[fn(key)] = mapKeys(value, fn)\n    } else {\n      result[fn(key)] = value\n    }\n  }\n\n  return result\n}\n","import { mapKeys } from \"./mapKeys\"\n\nexport const toSnakeCase = (object: unknown) =>\n  mapKeys(object, key =>\n    key.replace(/[A-Z]/g, match => `_${match.toLowerCase()}`),\n  )\n","/* eslint-disable no-await-in-loop */\n\nimport type { IDBPDatabase, IDBPTransaction } from \"idb\"\nimport { toSnakeCase } from \"../../../common/object/toSnakeCase\"\n\nexport const upgradeDatabase = async (\n  database: IDBPDatabase,\n  transaction: IDBPTransaction<unknown, string[], \"versionchange\">,\n  oldVersion: number,\n) => {\n  if (oldVersion < 2 && oldVersion >= 1) {\n    let cursor = await transaction.objectStore(\"backups\").openCursor()\n\n    while (cursor) {\n      await cursor.update({\n        name: cursor.key,\n        message: cursor.value,\n      })\n\n      cursor = await cursor.continue()\n    }\n  }\n\n  if (oldVersion < 3) {\n    database.createObjectStore(\"backup\", {\n      keyPath: \"id\",\n      autoIncrement: true,\n    })\n\n    const backupStore = transaction.objectStore(\"backup\")\n    backupStore.createIndex(\"name\", \"name\", {\n      unique: true,\n    })\n  }\n\n  if (oldVersion < 4 && oldVersion >= 1) {\n    const backupStore = transaction.objectStore(\"backup\")\n\n    const existingBackups = new Set<IDBValidKey>()\n    let nameCursor = await backupStore.index(\"name\").openKeyCursor()\n\n    while (nameCursor) {\n      existingBackups.add(nameCursor.key)\n      nameCursor = await nameCursor.continue()\n    }\n\n    let cursor = await transaction.objectStore(\"backups\").openCursor()\n\n    while (cursor) {\n      if (!existingBackups.has(cursor.key)) {\n        await backupStore.put({\n          ...cursor.value,\n          name: cursor.key,\n          message: toSnakeCase(cursor.value.message),\n        })\n      }\n\n      cursor = await cursor.continue()\n    }\n  }\n\n  if (oldVersion < 5 && oldVersion >= 1) {\n    const backupStore = transaction.objectStore(\"backup\")\n\n    let cursor = await backupStore.openCursor()\n\n    while (cursor) {\n      const { message, ...rest } = cursor.value\n\n      await backupStore.put({\n        ...rest,\n        messages: [message],\n      })\n\n      cursor = await cursor.continue()\n    }\n  }\n\n  if (oldVersion < 6 && oldVersion >= 1) {\n    const backupStore = transaction.objectStore(\"backup\")\n\n    let cursor = await backupStore.openCursor()\n\n    while (cursor) {\n      const { webhookUrl, ...rest } = cursor.value\n\n      await backupStore.put({\n        ...rest,\n        target: {\n          url: webhookUrl,\n        },\n      })\n\n      cursor = await cursor.continue()\n    }\n  }\n\n  if (oldVersion < 9 && oldVersion >= 1) {\n    const backupStore = transaction.objectStore(\"backup\")\n\n    let cursor = await backupStore.openCursor()\n\n    while (cursor) {\n      const { id, name, messages, target } = cursor.value\n\n      if (name) {\n        await backupStore.put({\n          id,\n          name,\n          messages: messages.map((data: Record<string, unknown>) => ({\n            data: \"data\" in data ? data.data : data,\n            reference: \"reference\" in data ? data.reference : target.message,\n          })),\n          target: {\n            url: target.url,\n          },\n        })\n      } else {\n        await backupStore.delete(id)\n      }\n\n      cursor = await cursor.continue()\n    }\n  }\n\n  if (oldVersion < 10 && oldVersion >= 1) {\n    const backupStore = transaction.objectStore(\"backup\")\n\n    let cursor = await backupStore.openCursor()\n\n    while (cursor) {\n      const { target, ...backup } = cursor.value\n\n      await backupStore.put({\n        ...backup,\n        targets: [{ url: target.url ?? \"\" }],\n      })\n\n      cursor = await cursor.continue()\n    }\n  }\n}\n","import { IDBPDatabase, IDBPTransaction, openDB } from \"idb\"\nimport type { Schema } from \"../Schema\"\nimport { showUpgradeBlockedMessage } from \"./showUpgradeBlockedMessage\"\nimport { upgradeDatabase } from \"./upgradeDatabase\"\n\nexport const openDatabase = async () => {\n  return openDB<Schema>(\"discohook\", 10, {\n    upgrade: (database, oldVersion, newVersion, transaction) => {\n      // Casting to unknown schema, because upgrades shouldn't assume how the\n      // schema looks at that time\n      upgradeDatabase(\n        database as IDBPDatabase,\n        transaction as IDBPTransaction<unknown, string[], \"versionchange\">,\n        oldVersion,\n      )\n        .then(() => {\n          localStorage.setItem(\"database-upgraded-version\", \"10\")\n          document.querySelector(\"#db-upgrade-blocked\")?.remove()\n        })\n        .catch(error => {\n          console.error(\"Error on database upgrade:\", error)\n        })\n    },\n    blocked: showUpgradeBlockedMessage,\n  })\n}\n","import type { IDBPDatabase } from \"idb\"\nimport { computed, observable } from \"mobx\"\nimport { openDatabase } from \"./connection/openDatabase\"\nimport type { Schema } from \"./Schema\"\n\nexport class DatabaseManager {\n  initialized: Promise<void>\n  database!: IDBPDatabase<Schema>\n\n  @observable persisted = true\n  @observable persistenceMessageDismissed = false\n\n  constructor() {\n    let markAsInitialized: () => void\n    this.initialized = new Promise(resolve => {\n      markAsInitialized = resolve\n    })\n\n    if (typeof window === \"undefined\") return\n\n    if (\"storage\" in navigator) {\n      navigator.storage\n        .persisted()\n        .then(persisted => {\n          this.persisted = persisted\n        })\n        .catch(() => {})\n    }\n\n    openDatabase()\n      .then(database => {\n        this.database = database\n        markAsInitialized()\n      })\n      .catch(error => {\n        console.error(\"Failed to open database:\", error)\n      })\n  }\n\n  async requestPersistence() {\n    if (\"chrome\" in window) {\n      await Notification.requestPermission()\n    }\n\n    if (\"storage\" in navigator) {\n      this.persisted = await navigator.storage.persist()\n    }\n  }\n\n  @computed get shouldShowPersistenceWarning() {\n    return !this.persisted && !this.persistenceMessageDismissed\n  }\n}\n","import { createContext } from \"react\"\nimport type { DatabaseManager } from \"./DatabaseManager\"\n\nexport const DatabaseManagerContext = createContext<DatabaseManager | null>(\n  null,\n)\n\nDatabaseManagerContext.displayName = \"DatabaseManagerContext\"\n\nexport const DatabaseManagerProvider = DatabaseManagerContext.Provider\n","import React from \"react\"\nimport { PrimaryButton } from \"../../../common/input/button/PrimaryButton\"\nimport { SecondaryButton } from \"../../../common/input/button/SecondaryButton\"\nimport { ModalAction } from \"../../../common/modal/layout/ModalAction\"\nimport { ModalBody } from \"../../../common/modal/layout/ModalBody\"\nimport { ModalContainer } from \"../../../common/modal/layout/ModalContainer\"\nimport { ModalFooter } from \"../../../common/modal/layout/ModalFooter\"\nimport { ModalHeader } from \"../../../common/modal/layout/ModalHeader\"\nimport { ModalTitle } from \"../../../common/modal/layout/ModalTitle\"\nimport { ModalContext } from \"../../../common/modal/ModalContext\"\nimport { useRequiredContext } from \"../../../common/state/useRequiredContext\"\nimport { remove } from \"../../../icons/remove\"\nimport { Markdown } from \"../../markdown/Markdown\"\nimport type { DatabaseManager } from \"../DatabaseManager\"\n\nexport type PushNotificationModalProps = {\n  databaseManager: DatabaseManager\n}\n\nexport function PushNotificationModal(props: PushNotificationModalProps) {\n  const { databaseManager } = props\n\n  const modal = useRequiredContext(ModalContext)\n\n  return (\n    <ModalContainer>\n      <ModalHeader>\n        <ModalTitle>Notice</ModalTitle>\n        <ModalAction\n          icon={remove}\n          label=\"Close\"\n          onClick={() => modal.dismiss()}\n        />\n      </ModalHeader>\n      <ModalBody>\n        <Markdown\n          content={\n            \"Chrome based browsers do not allow manual control of persistent\" +\n            \" storage. As a workaround, you can grant this site permission to\" +\n            \" send notifications to allow the site to use persistent storage.\"\n          }\n        />\n      </ModalBody>\n      <ModalFooter>\n        <SecondaryButton onClick={() => modal.dismiss()}>\n          Cancel\n        </SecondaryButton>\n        <PrimaryButton\n          onClick={async () => {\n            modal.dismiss()\n            await databaseManager.requestPersistence()\n          }}\n        >\n          Request permission\n        </PrimaryButton>\n      </ModalFooter>\n    </ModalContainer>\n  )\n}\n","import { useObserver } from \"mobx-react-lite\"\nimport React from \"react\"\nimport styled from \"styled-components\"\nimport { PrimaryButton } from \"../../../common/input/button/PrimaryButton\"\nimport { SecondaryButton } from \"../../../common/input/button/SecondaryButton\"\nimport { ButtonRow } from \"../../../common/layout/ButtonRow\"\nimport { ModalManagerContext } from \"../../../common/modal/ModalManagerContext\"\nimport { useRequiredContext } from \"../../../common/state/useRequiredContext\"\nimport { Markdown } from \"../../markdown/Markdown\"\nimport { DatabaseManagerContext } from \"../DatabaseManagerContext\"\nimport { PushNotificationModal } from \"./PushNotificationModal\"\n\nconst Container = styled.div`\n  margin-top: 16px;\n  padding: 16px;\n\n  background: ${({ theme }) => theme.background.secondary};\n  border-radius: 3px;\n`\n\nconst Header = styled.h5`\n  margin: 0 0 8px;\n\n  color: ${({ theme }) => theme.header.primary};\n  font-size: 1em;\n  font-weight: 500;\n  line-height: 1.375;\n`\n\nconst Buttons = styled(ButtonRow)`\n  margin-top: 16px;\n`\n\nexport function PersistentStorageWarning() {\n  const modalManager = useRequiredContext(ModalManagerContext)\n  const databaseManager = useRequiredContext(DatabaseManagerContext)\n\n  return useObserver(() => (\n    <Container>\n      <Header>Warning</Header>\n      <Markdown\n        content={\n          \"Your browser did not grant permission to use persistent storage\" +\n          \" for this site. Data stored might be deleted by the browser when\" +\n          \" this permission is not granted.\"\n        }\n      />\n      <Buttons>\n        <PrimaryButton\n          onClick={async () => {\n            if (\"chrome\" in window) {\n              modalManager.spawn({\n                render: () => (\n                  <PushNotificationModal databaseManager={databaseManager} />\n                ),\n              })\n            } else {\n              await databaseManager.requestPersistence()\n            }\n          }}\n        >\n          Request permission\n        </PrimaryButton>\n        <SecondaryButton\n          onClick={() => {\n            databaseManager.persistenceMessageDismissed = true\n          }}\n        >\n          Dismiss\n        </SecondaryButton>\n      </Buttons>\n    </Container>\n  ))\n}\n","export const downloadBlob = (blob: Blob, name: string) => {\n  const url = URL.createObjectURL(blob)\n\n  const anchor = document.createElement(\"a\")\n  document.body.append(anchor)\n\n  anchor.href = url\n  anchor.download = name\n\n  anchor.click()\n\n  anchor.remove()\n  URL.revokeObjectURL(url)\n}\n","/* eslint-disable no-await-in-loop */\n\nimport { observable, runInAction } from \"mobx\"\nimport { downloadBlob } from \"../../../common/dom/downloadBlob\"\nimport { toSnakeCase } from \"../../../common/object/toSnakeCase\"\nimport type { EditorManagerLike } from \"../../editor/EditorManager\"\nimport { messageOf } from \"../../message/helpers/messageOf\"\nimport type { MessageData } from \"../../message/state/data/MessageData\"\nimport type { DatabaseManager } from \"../DatabaseManager\"\nimport type { Backup } from \"./types/Backup\"\nimport type { BackupData } from \"./types/BackupData\"\nimport type { ExportData } from \"./types/ExportData\"\n\nexport class BackupManager {\n  private readonly databaseManager: DatabaseManager\n  private readonly editorManager: EditorManagerLike\n\n  @observable backups: BackupData[] = []\n\n  constructor(\n    databaseManager: DatabaseManager,\n    editorManager: EditorManagerLike,\n  ) {\n    this.databaseManager = databaseManager\n    this.editorManager = editorManager\n\n    databaseManager.initialized\n      .then(async () => {\n        await this.loadBackupList()\n      })\n      .catch(() => {})\n  }\n\n  private async loadBackupList() {\n    const backups: BackupData[] = []\n\n    let cursor = await this.databaseManager.database\n      .transaction(\"backup\")\n      .objectStore(\"backup\")\n      .index(\"name\")\n      .openKeyCursor()\n\n    while (cursor) {\n      backups.push({\n        id: cursor.primaryKey,\n        name: cursor.key,\n      })\n\n      cursor = await cursor.continue()\n    }\n\n    runInAction(() => {\n      this.backups = backups\n    })\n  }\n\n  private async getId(name: string) {\n    return this.databaseManager.database\n      .transaction(\"backup\")\n      .objectStore(\"backup\")\n      .index(\"name\")\n      .getKey(name)\n  }\n\n  async loadBackup(name: string) {\n    const backup = await this.databaseManager.database\n      .transaction(\"backup\")\n      .objectStore(\"backup\")\n      .index(\"name\")\n      .get(name)\n\n    if (!backup) return\n\n    this.editorManager.set(\n      \"messages\",\n      backup.messages.map(({ data, ...message }) => ({\n        ...messageOf(data),\n        ...message,\n      })),\n    )\n    this.editorManager.set(\"targets\", backup.targets)\n    for (const target of this.editorManager.targets) {\n      target.fetch().catch(() => {})\n    }\n  }\n\n  async saveBackup(backup: string | Backup) {\n    if (typeof backup === \"string\") {\n      const id = await this.getId(backup)\n\n      backup = {\n        id,\n        name: backup,\n        messages: this.editorManager.messages.map(message => ({\n          data: {\n            ...message.data,\n            files: undefined,\n          },\n          reference: message.reference,\n        })),\n        targets: this.editorManager.targets.map(target => ({\n          url: target.url,\n        })),\n      }\n    } else {\n      backup = {\n        ...backup,\n        id: await this.getId(backup.name),\n      }\n    }\n\n    if (!backup.id) delete backup.id\n\n    await this.databaseManager.database\n      .transaction(\"backup\", \"readwrite\")\n      .objectStore(\"backup\")\n      .put(backup)\n\n    await this.loadBackupList()\n  }\n\n  async deleteBackup(name: string) {\n    const id = await this.getId(name)\n    if (!id) return\n\n    await this.databaseManager.database\n      .transaction(\"backup\", \"readwrite\")\n      .objectStore(\"backup\")\n      .delete(id)\n\n    await this.loadBackupList()\n  }\n\n  async exportBackup(name: string) {\n    const backup = await this.databaseManager.database\n      .transaction(\"backup\")\n      .objectStore(\"backup\")\n      .index(\"name\")\n      .get(name)\n\n    if (!backup) return\n\n    const backupData: ExportData = {\n      version: 7,\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      backups: [backup].map(({ id, ...backup }) => backup),\n    }\n\n    const blob = new Blob([JSON.stringify(backupData, undefined, 2), \"\\n\"], {\n      type: \"application/json\",\n    })\n\n    downloadBlob(blob, `${name}.json`)\n  }\n\n  async exportAll() {\n    const backups: Backup[] = []\n\n    let cursor = await this.databaseManager.database\n      .transaction(\"backup\")\n      .objectStore(\"backup\")\n      .openCursor()\n\n    while (cursor) {\n      backups.push({\n        ...cursor.value,\n        id: undefined,\n      })\n\n      cursor = await cursor.continue()\n    }\n\n    const backupData: ExportData = {\n      version: 7,\n      backups,\n    }\n\n    const blob = new Blob([JSON.stringify(backupData, undefined, 2), \"\\n\"], {\n      type: \"application/json\",\n    })\n\n    downloadBlob(blob, \"backups.json\")\n  }\n\n  private async getSafeBackupName(name: string) {\n    if (!(await this.getId(name))) {\n      return name\n    }\n\n    for (let number = 1; true; number++) {\n      const proposedName = `${name} (${number})`\n\n      if (!(await this.getId(proposedName))) {\n        return proposedName\n      }\n    }\n  }\n\n  async importBackups(blob: Blob) {\n    let exportData = JSON.parse(await blob.text()) as ExportData\n\n    switch (exportData.version) {\n      case 1:\n      case 2: {\n        exportData = {\n          version: 3,\n          backups: [\n            {\n              name: exportData.name,\n              message: toSnakeCase(exportData.message) as MessageData,\n            },\n          ],\n        }\n      }\n      // falls through\n      case 3: {\n        exportData = {\n          version: 4,\n          backups: exportData.backups.map(({ message, ...backup }) => ({\n            ...backup,\n            messages: [message],\n          })),\n        }\n      }\n      // falls through\n      case 4:\n        exportData = {\n          version: 5,\n          backups: exportData.backups.map(({ webhookUrl, ...backup }) => ({\n            ...backup,\n            target: {\n              url: webhookUrl,\n            },\n          })),\n        }\n      // falls through\n      case 5:\n        exportData = {\n          version: 6,\n          backups: exportData.backups.map(\n            ({ messages, target, ...backup }) => ({\n              ...backup,\n              messages: messages.map(data => ({\n                data,\n                reference: target.message,\n              })),\n              target: {\n                url: target.url,\n              },\n            }),\n          ),\n        }\n      // falls through\n      case 6:\n        exportData = {\n          version: 7,\n          backups: exportData.backups.map(({ target, ...backup }) => ({\n            ...backup,\n            targets: [{ url: target.url ?? \"\" }],\n          })),\n        }\n      // falls through\n      case 7:\n        for (const backup of exportData.backups) {\n          await this.saveBackup({\n            ...backup,\n            name: await this.getSafeBackupName(backup.name),\n            id: undefined,\n          })\n        }\n    }\n  }\n}\n","import { createContext } from \"react\"\nimport type { BackupManager } from \"./BackupManager\"\n\nexport const BackupManagerContext = createContext<BackupManager | null>(null)\n\nBackupManagerContext.displayName = \"BackupManagerContext\"\n\nexport const BackupManagerProvider = BackupManagerContext.Provider\n","import { useObserver } from \"mobx-react-lite\"\nimport React, { useState } from \"react\"\nimport { PrimaryButton } from \"../../../../common/input/button/PrimaryButton\"\nimport { InputField } from \"../../../../common/input/text/InputField\"\nimport { useRequiredContext } from \"../../../../common/state/useRequiredContext\"\nimport { BackupManagerContext } from \"../BackupManagerContext\"\n\nexport function BackupCreationControls() {\n  const backupManager = useRequiredContext(BackupManagerContext)\n\n  const [backupName, setBackupName] = useState(\"\")\n\n  return useObserver(() => (\n    <InputField\n      id=\"backup-name\"\n      value={backupName}\n      onChange={setBackupName}\n      label=\"Backup name\"\n    >\n      <PrimaryButton\n        disabled={backupName.length === 0}\n        onClick={async () => {\n          await backupManager.saveBackup(backupName.trim())\n          setBackupName(\"\")\n        }}\n      >\n        {backupManager.backups.some(backup => backup.name === backupName.trim())\n          ? \"Overwrite\"\n          : \"Save\"}\n      </PrimaryButton>\n    </InputField>\n  ))\n}\n","import React from \"react\"\n\nexport const save = (\n  <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\">\n    <path\n      d=\"M11 15V9H5V15M5 1L4.99999 5H10M13.6667 15H2.33333C1.97971 15 1.64057 14.8595 1.39052 14.6095C1.14048 14.3594 1 14.0203 1 13.6667V2.33333C1 1.97971 1.14048 1.64057 1.39052 1.39052C1.64057 1.14048 1.97971 1 2.33333 1H11.6667L15 4.33333V13.6667C15 14.0203 14.8595 14.3594 14.6095 14.6095C14.3594 14.8595 14.0203 15 13.6667 15Z\"\n      stroke=\"currentColor\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    />\n  </svg>\n)\n","import React from \"react\"\n\nexport const trash = (\n  <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\">\n    <path\n      d=\"M1 4L2.99999 3.99998M2.99999 3.99998V13.5C2.99999 14.3284 3.67156 15 4.49999 15L11.5 15C12.3284 15 13 14.3284 13 13.5V4M2.99999 3.99998H5.33333M13 4H15M13 4L10.6667 3.99998M5.33333 3.99998V2.5C5.33333 1.67157 6.00491 1 6.83333 1H9.16667C9.99509 1 10.6667 1.67157 10.6667 2.5V3.99998M5.33333 3.99998H10.6667\"\n      stroke=\"currentColor\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    />\n  </svg>\n)\n","import React from \"react\"\n\nexport const upload = (\n  <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\">\n    <path\n      d=\"M14 10V12.6667C14 13.0203 13.8595 13.3594 13.6095 13.6095C13.3594 13.8595 13.0203 14 12.6667 14H3.33333C2.97971 14 2.64057 13.8595 2.39052 13.6095C2.14048 13.3594 2 13.0203 2 12.6667V10M4.66667 5.33333L8 2M8 2L11.3333 5.33333M8 2V10\"\n      stroke=\"currentColor\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    />\n  </svg>\n)\n","import { useObserver } from \"mobx-react-lite\"\nimport React from \"react\"\nimport { PrimaryButton } from \"../../../../common/input/button/PrimaryButton\"\nimport { SecondaryButton } from \"../../../../common/input/button/SecondaryButton\"\nimport { ModalAction } from \"../../../../common/modal/layout/ModalAction\"\nimport { ModalBody } from \"../../../../common/modal/layout/ModalBody\"\nimport { ModalContainer } from \"../../../../common/modal/layout/ModalContainer\"\nimport { ModalFooter } from \"../../../../common/modal/layout/ModalFooter\"\nimport { ModalHeader } from \"../../../../common/modal/layout/ModalHeader\"\nimport { ModalTitle } from \"../../../../common/modal/layout/ModalTitle\"\nimport { ModalContext } from \"../../../../common/modal/ModalContext\"\nimport { useRequiredContext } from \"../../../../common/state/useRequiredContext\"\nimport { remove } from \"../../../../icons/remove\"\nimport { Markdown } from \"../../../markdown/Markdown\"\nimport type { BackupManager } from \"../BackupManager\"\nimport type { BackupData } from \"../types/BackupData\"\n\nexport type DeletionConfirmationModalProps = {\n  backupManager: BackupManager\n  backup: BackupData\n}\n\nexport function DeletionConfirmationModal(\n  props: DeletionConfirmationModalProps,\n) {\n  const { backupManager, backup } = props\n\n  const modal = useRequiredContext(ModalContext)\n\n  return useObserver(() => (\n    <ModalContainer>\n      <ModalHeader>\n        <ModalTitle>Delete Backup</ModalTitle>\n        <ModalAction\n          icon={remove}\n          label=\"Close\"\n          onClick={() => modal.dismiss()}\n        />\n      </ModalHeader>\n      <ModalBody>\n        <Markdown\n          content={\n            `Are you sure you want to delete \"${backup.name}\"? This action` +\n            \" cannot be undone.\"\n          }\n        />\n      </ModalBody>\n      <ModalFooter>\n        <SecondaryButton onClick={() => modal.dismiss()}>\n          Cancel\n        </SecondaryButton>\n        <PrimaryButton\n          onClick={async () => {\n            await backupManager.deleteBackup(backup.name)\n            modal.dismiss()\n          }}\n        >\n          Delete\n        </PrimaryButton>\n      </ModalFooter>\n    </ModalContainer>\n  ))\n}\n","import { useObserver } from \"mobx-react-lite\"\nimport { ellipsis } from \"polished\"\nimport React from \"react\"\nimport styled from \"styled-components\"\nimport { Button } from \"../../../../common/input/button/Button\"\nimport { ActionButtons } from \"../../../../common/layout/ActionButtons\"\nimport { ModalManagerContext } from \"../../../../common/modal/ModalManagerContext\"\nimport { useRequiredContext } from \"../../../../common/state/useRequiredContext\"\nimport { copy } from \"../../../../icons/copy\"\nimport { save } from \"../../../../icons/save\"\nimport { trash } from \"../../../../icons/trash\"\nimport { upload } from \"../../../../icons/upload\"\nimport { BackupManagerContext } from \"../BackupManagerContext\"\nimport type { BackupData } from \"../types/BackupData\"\nimport { DeletionConfirmationModal } from \"./DeletionConfirmationModal\"\n\nconst Container = styled.li`\n  height: 48px;\n\n  display: flex;\n  align-items: center;\n\n  list-style: none;\n\n  border: 0 solid ${({ theme }) => theme.backgroundModifier.accent};\n\n  & + & {\n    border-top-width: 1px;\n  }\n\n  & > ${Button} {\n    margin: 0;\n  }\n`\n\nconst BackupName = styled.div`\n  ${ellipsis()};\n\n  flex: 1;\n  font-weight: 500;\n`\n\nexport type BackupItemProps = {\n  backup: BackupData\n}\n\nexport function BackupItem(props: BackupItemProps) {\n  const { backup } = props\n\n  const modalManager = useRequiredContext(ModalManagerContext)\n  const backupManager = useRequiredContext(BackupManagerContext)\n\n  return useObserver(() => (\n    <Container>\n      <BackupName>{backup.name}</BackupName>\n      <ActionButtons\n        actions={[\n          {\n            icon: upload,\n            label: \"Load\",\n            handler: async () => backupManager.loadBackup(backup.name),\n          },\n          {\n            icon: save,\n            label: \"Export\",\n            handler: async () => backupManager.exportBackup(backup.name),\n            overflow: true,\n          },\n          {\n            icon: copy,\n            label: \"Overwrite\",\n            handler: async () => backupManager.saveBackup(backup.name),\n            overflow: true,\n          },\n          {\n            icon: trash,\n            label: \"Delete\",\n            handler: () =>\n              modalManager.spawn({\n                render: () => (\n                  <DeletionConfirmationModal\n                    backupManager={backupManager}\n                    backup={backup}\n                  />\n                ),\n              }),\n            overflow: true,\n          },\n        ]}\n      />\n    </Container>\n  ))\n}\n","import { useObserver } from \"mobx-react-lite\"\nimport React, { useState } from \"react\"\nimport styled from \"styled-components\"\nimport { InputField } from \"../../../../common/input/text/InputField\"\nimport { useRequiredContext } from \"../../../../common/state/useRequiredContext\"\nimport { Markdown } from \"../../../markdown/Markdown\"\nimport { BackupManagerContext } from \"../BackupManagerContext\"\nimport { BackupItem } from \"./BackupItem\"\n\nconst Container = styled.ul`\n  padding: 0;\n  margin: 0;\n\n  max-height: 420px;\n  overflow-x: hidden;\n`\n\nexport function BackupList() {\n  const backupManager = useRequiredContext(BackupManagerContext)\n\n  const [search, setSearch] = useState(\"\")\n\n  return useObserver(() =>\n    backupManager.backups.length > 0 ? (\n      <>\n        <InputField\n          id=\"backups-search\"\n          label=\"Search Backups\"\n          value={search}\n          onChange={setSearch}\n        />\n        <Container>\n          {backupManager.backups\n            .filter(backup =>\n              backup.name\n                .toLocaleLowerCase()\n                .includes(search.toLocaleLowerCase()),\n            )\n            .map(backup => (\n              <BackupItem key={backup.id} backup={backup} />\n            ))}\n        </Container>\n      </>\n    ) : (\n      <Markdown\n        content={\n          \"You haven't made any backups yet.\" +\n          \" Enter a name below and click on the Save button to make one.\"\n        }\n      />\n    ),\n  )\n}\n","import { useObserver } from \"mobx-react-lite\"\nimport React, { useRef } from \"react\"\nimport { PrimaryButton } from \"../../../../common/input/button/PrimaryButton\"\nimport { SecondaryButton } from \"../../../../common/input/button/SecondaryButton\"\nimport { ModalAction } from \"../../../../common/modal/layout/ModalAction\"\nimport { ModalBody } from \"../../../../common/modal/layout/ModalBody\"\nimport { ModalContainer } from \"../../../../common/modal/layout/ModalContainer\"\nimport { ModalFooter } from \"../../../../common/modal/layout/ModalFooter\"\nimport { ModalHeader } from \"../../../../common/modal/layout/ModalHeader\"\nimport { ModalTitle } from \"../../../../common/modal/layout/ModalTitle\"\nimport { ModalContext } from \"../../../../common/modal/ModalContext\"\nimport { useLazyValue } from \"../../../../common/state/useLazyValue\"\nimport { useRequiredContext } from \"../../../../common/state/useRequiredContext\"\nimport { remove } from \"../../../../icons/remove\"\nimport type { EditorManagerLike } from \"../../../editor/EditorManager\"\nimport { DatabaseManager } from \"../../DatabaseManager\"\nimport { DatabaseManagerProvider } from \"../../DatabaseManagerContext\"\nimport { PersistentStorageWarning } from \"../../persist/PersistentStorageWarning\"\nimport { BackupManager } from \"../BackupManager\"\nimport { BackupManagerProvider } from \"../BackupManagerContext\"\nimport { BackupCreationControls } from \"./BackupCreationControls\"\nimport { BackupList } from \"./BackupList\"\n\nexport type BackupsModalProps = {\n  editorManager: EditorManagerLike\n}\n\nexport function BackupsModal(props: BackupsModalProps) {\n  const { editorManager } = props\n\n  const databaseManager = useLazyValue(() => new DatabaseManager())\n  const backupManager = useLazyValue(\n    () => new BackupManager(databaseManager, editorManager),\n  )\n\n  const modal = useRequiredContext(ModalContext)\n\n  const fileInputRef = useRef<HTMLInputElement>(null)\n\n  return useObserver(() => (\n    <DatabaseManagerProvider value={databaseManager}>\n      <BackupManagerProvider value={backupManager}>\n        <ModalContainer>\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            style={{ display: \"none\" }}\n            onChange={async event => {\n              const file = event.target.files?.item(0)?.slice()\n              event.target.files = null\n              if (file) {\n                await backupManager.importBackups(file)\n              }\n            }}\n          />\n          <ModalHeader>\n            <ModalTitle>Backups</ModalTitle>\n            <ModalAction\n              icon={remove}\n              label=\"Close\"\n              onClick={() => modal.dismiss()}\n            />\n          </ModalHeader>\n          {databaseManager.shouldShowPersistenceWarning && (\n            <ModalBody>\n              <PersistentStorageWarning />\n            </ModalBody>\n          )}\n          <ModalBody>\n            <BackupList />\n          </ModalBody>\n          <ModalBody>\n            <BackupCreationControls />\n          </ModalBody>\n          <ModalFooter>\n            <SecondaryButton onClick={async () => backupManager.exportAll()}>\n              Export All\n            </SecondaryButton>\n            <SecondaryButton onClick={() => fileInputRef.current?.click()}>\n              Import\n            </SecondaryButton>\n            <PrimaryButton onClick={() => modal.dismiss()}>Close</PrimaryButton>\n          </ModalFooter>\n        </ModalContainer>\n      </BackupManagerProvider>\n    </DatabaseManagerProvider>\n  ))\n}\n"]}}