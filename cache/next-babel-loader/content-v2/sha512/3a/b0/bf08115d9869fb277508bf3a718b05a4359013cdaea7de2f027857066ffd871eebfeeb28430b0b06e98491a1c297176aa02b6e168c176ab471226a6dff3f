{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { getTime } from \"date-fns\";\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { PopoverContainer } from \"../../popover/PopoverContainer\";\nimport { usePopover } from \"../../popover/usePopover\";\nimport { InputField } from \"../text/InputField\";\nimport { DatePicker } from \"./DatePicker\";\nimport { getDateTimeString } from \"./getDateTimeString\";\nconst TIMESTAMP_FORMAT_RE = /^(\\d{4})-(\\d{2})-(\\d{2}) (\\d{2}):(\\d{2})$/;\nexport function TimestampInputField(props) {\n  const {\n    id,\n    value,\n    onChange: handleChange,\n    label\n  } = props;\n  const {\n    0: input,\n    1: setInput\n  } = useState(() => {\n    var _getDateTimeString;\n\n    return (_getDateTimeString = getDateTimeString(value)) !== null && _getDateTimeString !== void 0 ? _getDateTimeString : \"\";\n  });\n  const lastDateRef = useRef(value.getTime());\n  useEffect(() => {\n    // Object.is considers NaN to be equal to NaN\n    if (!Object.is(lastDateRef.current, getTime(value))) {\n      var _getDateTimeString2;\n\n      setInput((_getDateTimeString2 = getDateTimeString(value)) !== null && _getDateTimeString2 !== void 0 ? _getDateTimeString2 : \"\");\n    }\n\n    lastDateRef.current = getTime(value);\n  }, [value]);\n\n  const handleInputChange = value => {\n    setInput(value);\n\n    if (!value) {\n      handleChange(new Date(Number.NaN));\n      return;\n    }\n\n    const match = TIMESTAMP_FORMAT_RE.exec(value);\n    if (!match) return;\n    const [, year, month, day, hours, minutes] = match;\n    handleChange(new Date(Number(year), Number(month) - 1, Number(day), Number(hours), Number(minutes)));\n  };\n\n  const inputRef = useRef(null);\n  const popover = usePopover({\n    ref: inputRef,\n    render: () => /*#__PURE__*/_jsx(PopoverContainer, {\n      children: /*#__PURE__*/_jsx(DatePicker, {\n        date: value,\n        onChange: handleChange\n      })\n    }),\n    placement: \"bottom-start\",\n    shards: [inputRef]\n  });\n  return /*#__PURE__*/_jsx(InputField, {\n    ref: inputRef,\n    id: id,\n    value: input,\n    label: label,\n    placeholder: \"YYYY-MM-DD hh:mm\",\n    error: input && !TIMESTAMP_FORMAT_RE.test(input) ? \"Invalid date format\" : undefined,\n    onChange: handleInputChange,\n    onClick: () => {\n      popover.spawn();\n    }\n  });\n}","map":{"version":3,"sources":["/home/runner/work/site/site/common/input/timestamp/TimestampInputField.tsx"],"names":["getTime","React","useEffect","useRef","useState","PopoverContainer","usePopover","InputField","DatePicker","getDateTimeString","TIMESTAMP_FORMAT_RE","TimestampInputField","props","id","value","onChange","handleChange","label","input","setInput","lastDateRef","Object","is","current","handleInputChange","Date","Number","NaN","match","exec","year","month","day","hours","minutes","inputRef","popover","ref","render","placement","shards","test","undefined","spawn"],"mappings":"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","sourcesContent":["import { getTime } from \"date-fns\"\nimport React, { useEffect, useRef, useState } from \"react\"\nimport { PopoverContainer } from \"../../popover/PopoverContainer\"\nimport { usePopover } from \"../../popover/usePopover\"\nimport { InputField } from \"../text/InputField\"\nimport { DatePicker } from \"./DatePicker\"\nimport { getDateTimeString } from \"./getDateTimeString\"\n\nconst TIMESTAMP_FORMAT_RE = /^(\\d{4})-(\\d{2})-(\\d{2}) (\\d{2}):(\\d{2})$/\n\nexport type TimestampInputProps = {\n  id: string\n  value: Date\n  onChange: (value: Date) => void\n  label: string\n}\n\nexport function TimestampInputField(props: TimestampInputProps) {\n  const { id, value, onChange: handleChange, label } = props\n\n  const [input, setInput] = useState(() => getDateTimeString(value) ?? \"\")\n\n  const lastDateRef = useRef<number>(value.getTime())\n  useEffect(() => {\n    // Object.is considers NaN to be equal to NaN\n    if (!Object.is(lastDateRef.current, getTime(value))) {\n      setInput(getDateTimeString(value) ?? \"\")\n    }\n\n    lastDateRef.current = getTime(value)\n  }, [value])\n\n  const handleInputChange = (value: string) => {\n    setInput(value)\n\n    if (!value) {\n      handleChange(new Date(Number.NaN))\n      return\n    }\n\n    const match = TIMESTAMP_FORMAT_RE.exec(value)\n    if (!match) return\n\n    const [, year, month, day, hours, minutes] = match\n    handleChange(\n      new Date(\n        Number(year),\n        Number(month) - 1,\n        Number(day),\n        Number(hours),\n        Number(minutes),\n      ),\n    )\n  }\n\n  const inputRef = useRef<HTMLInputElement>(null)\n\n  const popover = usePopover({\n    ref: inputRef,\n    render: () => (\n      <PopoverContainer>\n        <DatePicker date={value} onChange={handleChange} />\n      </PopoverContainer>\n    ),\n    placement: \"bottom-start\",\n    shards: [inputRef],\n  })\n\n  return (\n    <InputField\n      ref={inputRef}\n      id={id}\n      value={input}\n      label={label}\n      placeholder=\"YYYY-MM-DD hh:mm\"\n      error={\n        input && !TIMESTAMP_FORMAT_RE.test(input)\n          ? \"Invalid date format\"\n          : undefined\n      }\n      onChange={handleInputChange}\n      onClick={() => {\n        popover.spawn()\n      }}\n    />\n  )\n}\n"]},"metadata":{},"sourceType":"module"}